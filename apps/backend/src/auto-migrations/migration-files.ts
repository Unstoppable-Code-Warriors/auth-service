
export const MIGRATION_FILES = [
  {
    "name": "20240306152532_initial_migration",
    "sql": "-- CreateEnum\nCREATE TYPE \"ProxiedOAuthProviderType\" AS ENUM ('GITHUB', 'FACEBOOK', 'GOOGLE', 'MICROSOFT');\n\n-- CreateEnum\nCREATE TYPE \"StandardOAuthProviderType\" AS ENUM ('GITHUB', 'FACEBOOK', 'GOOGLE', 'MICROSOFT');\n\n-- CreateTable\nCREATE TABLE \"Project\" (\n    \"id\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"displayName\" TEXT NOT NULL,\n    \"description\" TEXT DEFAULT '',\n    \"configId\" UUID NOT NULL,\n    \"isProductionMode\" BOOLEAN NOT NULL,\n\n    CONSTRAINT \"Project_pkey\" PRIMARY KEY (\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectConfig\" (\n    \"id\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"allowLocalhost\" BOOLEAN NOT NULL,\n    \"credentialEnabled\" BOOLEAN NOT NULL,\n\n    CONSTRAINT \"ProjectConfig_pkey\" PRIMARY KEY (\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectDomain\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"domain\" TEXT NOT NULL,\n    \"handlerPath\" TEXT NOT NULL\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectConfigOverride\" (\n    \"projectId\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"ProjectConfigOverride_pkey\" PRIMARY KEY (\"projectId\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectUser\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"primaryEmail\" TEXT,\n    \"primaryEmailVerified\" BOOLEAN NOT NULL,\n    \"profileImageUrl\" TEXT,\n    \"displayName\" TEXT,\n    \"passwordHash\" TEXT,\n    \"serverMetadata\" JSONB,\n    \"clientMetadata\" JSONB,\n\n    CONSTRAINT \"ProjectUser_pkey\" PRIMARY KEY (\"projectId\",\"projectUserId\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectUserOAuthAccount\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"projectConfigId\" UUID NOT NULL,\n    \"oauthProviderConfigId\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"email\" TEXT,\n    \"providerAccountId\" TEXT NOT NULL,\n    \"providerRefreshToken\" TEXT,\n\n    CONSTRAINT \"ProjectUserOAuthAccount_pkey\" PRIMARY KEY (\"projectId\",\"oauthProviderConfigId\",\"providerAccountId\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectUserRefreshToken\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"refreshToken\" TEXT NOT NULL,\n    \"expiresAt\" TIMESTAMP(3),\n\n    CONSTRAINT \"ProjectUserRefreshToken_pkey\" PRIMARY KEY (\"projectId\",\"refreshToken\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectUserAuthorizationCode\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"authorizationCode\" TEXT NOT NULL,\n    \"redirectUri\" TEXT NOT NULL,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n    \"codeChallenge\" TEXT NOT NULL,\n    \"codeChallengeMethod\" TEXT NOT NULL,\n\n    CONSTRAINT \"ProjectUserAuthorizationCode_pkey\" PRIMARY KEY (\"projectId\",\"authorizationCode\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectUserEmailVerificationCode\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"code\" TEXT NOT NULL,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n    \"usedAt\" TIMESTAMP(3),\n    \"redirectUrl\" TEXT NOT NULL,\n\n    CONSTRAINT \"ProjectUserEmailVerificationCode_pkey\" PRIMARY KEY (\"projectId\",\"code\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectUserPasswordResetCode\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"code\" TEXT NOT NULL,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n    \"usedAt\" TIMESTAMP(3),\n    \"redirectUrl\" TEXT NOT NULL,\n\n    CONSTRAINT \"ProjectUserPasswordResetCode_pkey\" PRIMARY KEY (\"projectId\",\"code\")\n);\n\n-- CreateTable\nCREATE TABLE \"ApiKeySet\" (\n    \"projectId\" TEXT NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"description\" TEXT NOT NULL,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n    \"manuallyRevokedAt\" TIMESTAMP(3),\n    \"publishableClientKey\" TEXT,\n    \"secretServerKey\" TEXT,\n    \"superSecretAdminKey\" TEXT,\n\n    CONSTRAINT \"ApiKeySet_pkey\" PRIMARY KEY (\"projectId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"EmailServiceConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"senderName\" TEXT NOT NULL,\n\n    CONSTRAINT \"EmailServiceConfig_pkey\" PRIMARY KEY (\"projectConfigId\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProxiedEmailServiceConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"ProxiedEmailServiceConfig_pkey\" PRIMARY KEY (\"projectConfigId\")\n);\n\n-- CreateTable\nCREATE TABLE \"StandardEmailServiceConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"senderEmail\" TEXT NOT NULL,\n    \"host\" TEXT NOT NULL,\n    \"port\" INTEGER NOT NULL,\n    \"username\" TEXT NOT NULL,\n    \"password\" TEXT NOT NULL,\n\n    CONSTRAINT \"StandardEmailServiceConfig_pkey\" PRIMARY KEY (\"projectConfigId\")\n);\n\n-- CreateTable\nCREATE TABLE \"OAuthProviderConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"id\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"enabled\" BOOLEAN NOT NULL DEFAULT true,\n\n    CONSTRAINT \"OAuthProviderConfig_pkey\" PRIMARY KEY (\"projectConfigId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProxiedOAuthProviderConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"id\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"type\" \"ProxiedOAuthProviderType\" NOT NULL,\n\n    CONSTRAINT \"ProxiedOAuthProviderConfig_pkey\" PRIMARY KEY (\"projectConfigId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"StandardOAuthProviderConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"id\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"type\" \"StandardOAuthProviderType\" NOT NULL,\n    \"tenantId\" TEXT,\n    \"clientId\" TEXT NOT NULL,\n    \"clientSecret\" TEXT NOT NULL,\n\n    CONSTRAINT \"StandardOAuthProviderConfig_pkey\" PRIMARY KEY (\"projectConfigId\",\"id\")\n);\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProjectDomain_projectConfigId_domain_key\" ON \"ProjectDomain\"(\"projectConfigId\", \"domain\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProjectUserRefreshToken_refreshToken_key\" ON \"ProjectUserRefreshToken\"(\"refreshToken\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProjectUserAuthorizationCode_authorizationCode_key\" ON \"ProjectUserAuthorizationCode\"(\"authorizationCode\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProjectUserEmailVerificationCode_code_key\" ON \"ProjectUserEmailVerificationCode\"(\"code\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProjectUserPasswordResetCode_code_key\" ON \"ProjectUserPasswordResetCode\"(\"code\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ApiKeySet_publishableClientKey_key\" ON \"ApiKeySet\"(\"publishableClientKey\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ApiKeySet_secretServerKey_key\" ON \"ApiKeySet\"(\"secretServerKey\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ApiKeySet_superSecretAdminKey_key\" ON \"ApiKeySet\"(\"superSecretAdminKey\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProxiedOAuthProviderConfig_projectConfigId_type_key\" ON \"ProxiedOAuthProviderConfig\"(\"projectConfigId\", \"type\");\n\n-- AddForeignKey\nALTER TABLE \"Project\" ADD CONSTRAINT \"Project_configId_fkey\" FOREIGN KEY (\"configId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectDomain\" ADD CONSTRAINT \"ProjectDomain_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectConfigOverride\" ADD CONSTRAINT \"ProjectConfigOverride_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUser\" ADD CONSTRAINT \"ProjectUser_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" ADD CONSTRAINT \"ProjectUserOAuthAccount_projectConfigId_oauthProviderConfi_fkey\" FOREIGN KEY (\"projectConfigId\", \"oauthProviderConfigId\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" ADD CONSTRAINT \"ProjectUserOAuthAccount_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserRefreshToken\" ADD CONSTRAINT \"ProjectUserRefreshToken_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserAuthorizationCode\" ADD CONSTRAINT \"ProjectUserAuthorizationCode_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserEmailVerificationCode\" ADD CONSTRAINT \"ProjectUserEmailVerificationCode_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserPasswordResetCode\" ADD CONSTRAINT \"ProjectUserPasswordResetCode_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ApiKeySet\" ADD CONSTRAINT \"ApiKeySet_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"EmailServiceConfig\" ADD CONSTRAINT \"EmailServiceConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProxiedEmailServiceConfig\" ADD CONSTRAINT \"ProxiedEmailServiceConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"EmailServiceConfig\"(\"projectConfigId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"StandardEmailServiceConfig\" ADD CONSTRAINT \"StandardEmailServiceConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"EmailServiceConfig\"(\"projectConfigId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthProviderConfig\" ADD CONSTRAINT \"OAuthProviderConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProxiedOAuthProviderConfig\" ADD CONSTRAINT \"ProxiedOAuthProviderConfig_projectConfigId_id_fkey\" FOREIGN KEY (\"projectConfigId\", \"id\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"StandardOAuthProviderConfig\" ADD CONSTRAINT \"StandardOAuthProviderConfig_projectConfigId_id_fkey\" FOREIGN KEY (\"projectConfigId\", \"id\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240313024014_authroization_code_new_user",
    "sql": "-- AlterTable\nALTER TABLE \"ProjectUserAuthorizationCode\" ADD COLUMN     \"newUser\" BOOLEAN NOT NULL DEFAULT false;\n"
  },
  {
    "name": "20240418090527_magic_link",
    "sql": "-- AlterTable\nALTER TABLE \"ProjectConfig\" ADD COLUMN     \"magicLinkEnabled\" BOOLEAN NOT NULL DEFAULT false;\n\n-- AlterTable, authWithEmail default to true if password hash is set previously, otherwise false\nALTER TABLE \"ProjectUser\" ADD COLUMN \"authWithEmail\" BOOLEAN NOT NULL DEFAULT false;\nUPDATE \"ProjectUser\" SET \"authWithEmail\" = true WHERE \"passwordHash\" IS NOT NULL;\n\n-- CreateTable\nCREATE TABLE \"ProjectUserMagicLinkCode\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"code\" TEXT NOT NULL,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n    \"usedAt\" TIMESTAMP(3),\n    \"redirectUrl\" TEXT NOT NULL,\n    \"newUser\" BOOLEAN NOT NULL,\n\n    CONSTRAINT \"ProjectUserMagicLinkCode_pkey\" PRIMARY KEY (\"projectId\",\"code\")\n);\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProjectUserMagicLinkCode_code_key\" ON \"ProjectUserMagicLinkCode\"(\"code\");\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserMagicLinkCode\" ADD CONSTRAINT \"ProjectUserMagicLinkCode_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240507195652_team",
    "sql": "\n-- CreateEnum\nCREATE TYPE \"PermissionScope\" AS ENUM ('GLOBAL', 'TEAM');\n\n-- AlterTable\nALTER TABLE \"ProjectConfig\" ADD COLUMN \"createTeamOnSignUp\" BOOLEAN NOT NULL DEFAULT false;\nALTER TABLE \"ProjectConfig\" ALTER COLUMN \"createTeamOnSignUp\" DROP DEFAULT;\nALTER TABLE \"ProjectConfig\" ALTER COLUMN \"magicLinkEnabled\" DROP DEFAULT;\n\n\n-- AlterTable\nALTER TABLE \"ProjectUser\" ALTER COLUMN \"authWithEmail\" DROP DEFAULT;\n\n-- AlterTable\nALTER TABLE \"ProjectUserAuthorizationCode\" ALTER COLUMN \"newUser\" DROP DEFAULT;\n\n-- CreateTable\nCREATE TABLE \"Team\" (\n    \"projectId\" TEXT NOT NULL,\n    \"teamId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"displayName\" TEXT NOT NULL,\n\n    CONSTRAINT \"Team_pkey\" PRIMARY KEY (\"projectId\",\"teamId\")\n);\n\n-- CreateTable\nCREATE TABLE \"TeamMember\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"teamId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"TeamMember_pkey\" PRIMARY KEY (\"projectId\",\"projectUserId\",\"teamId\")\n);\n\n-- CreateTable\nCREATE TABLE \"TeamMemberDirectPermission\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"teamId\" UUID NOT NULL,\n    \"permissionDbId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"TeamMemberDirectPermission_pkey\" PRIMARY KEY (\"projectId\",\"projectUserId\",\"teamId\",\"permissionDbId\")\n);\n\n-- CreateTable\nCREATE TABLE \"Permission\" (\n    \"queryableId\" TEXT NOT NULL,\n    \"dbId\" UUID NOT NULL,\n    \"projectConfigId\" UUID,\n    \"projectId\" TEXT,\n    \"teamId\" UUID,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"description\" TEXT,\n    \"scope\" \"PermissionScope\" NOT NULL,\n\n    CONSTRAINT \"Permission_pkey\" PRIMARY KEY (\"dbId\")\n);\n\n-- CreateTable\nCREATE TABLE \"PermissionEdge\" (\n    \"edgeId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"parentPermissionDbId\" UUID NOT NULL,\n    \"childPermissionDbId\" UUID NOT NULL,\n\n    CONSTRAINT \"PermissionEdge_pkey\" PRIMARY KEY (\"edgeId\")\n);\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"Permission_projectConfigId_queryableId_key\" ON \"Permission\"(\"projectConfigId\", \"queryableId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"Permission_projectId_teamId_queryableId_key\" ON \"Permission\"(\"projectId\", \"teamId\", \"queryableId\");\n\n-- AddForeignKey\nALTER TABLE \"Team\" ADD CONSTRAINT \"Team_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"TeamMember\" ADD CONSTRAINT \"TeamMember_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"TeamMember\" ADD CONSTRAINT \"TeamMember_projectId_teamId_fkey\" FOREIGN KEY (\"projectId\", \"teamId\") REFERENCES \"Team\"(\"projectId\", \"teamId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"TeamMemberDirectPermission\" ADD CONSTRAINT \"TeamMemberDirectPermission_projectId_projectUserId_teamId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\", \"teamId\") REFERENCES \"TeamMember\"(\"projectId\", \"projectUserId\", \"teamId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"TeamMemberDirectPermission\" ADD CONSTRAINT \"TeamMemberDirectPermission_permissionDbId_fkey\" FOREIGN KEY (\"permissionDbId\") REFERENCES \"Permission\"(\"dbId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"Permission\" ADD CONSTRAINT \"Permission_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE SET NULL ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"Permission\" ADD CONSTRAINT \"Permission_projectId_teamId_fkey\" FOREIGN KEY (\"projectId\", \"teamId\") REFERENCES \"Team\"(\"projectId\", \"teamId\") ON DELETE SET NULL ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PermissionEdge\" ADD CONSTRAINT \"PermissionEdge_parentPermissionDbId_fkey\" FOREIGN KEY (\"parentPermissionDbId\") REFERENCES \"Permission\"(\"dbId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PermissionEdge\" ADD CONSTRAINT \"PermissionEdge_childPermissionDbId_fkey\" FOREIGN KEY (\"childPermissionDbId\") REFERENCES \"Permission\"(\"dbId\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240518151916_email_config",
    "sql": "/*\n  Warnings:\n\n  - You are about to drop the column `senderName` on the `EmailServiceConfig` table. All the data in the column will be lost.\n  - Added the required column `senderName` to the `StandardEmailServiceConfig` table without a default value. This is not possible if the table is not empty.\n\n*/\n-- AlterTable\nALTER TABLE \"EmailServiceConfig\" DROP COLUMN \"senderName\";\n\n-- AlterTable\nALTER TABLE \"StandardEmailServiceConfig\" ADD COLUMN     \"senderName\" TEXT NOT NULL;\n"
  },
  {
    "name": "20240520152704_selected_team",
    "sql": "-- AlterTable\nALTER TABLE \"ProjectUser\" ADD COLUMN     \"selectedTeamId\" UUID;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUser\" ADD CONSTRAINT \"ProjectUser_projectId_selectedTeamId_fkey\" FOREIGN KEY (\"projectId\", \"selectedTeamId\") REFERENCES \"Team\"(\"projectId\", \"teamId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240528090210_email_templates",
    "sql": "-- CreateEnum\nCREATE TYPE \"EmailTemplateType\" AS ENUM ('EMAIL_VERIFICATION', 'PASSWORD_RESET', 'MAGIC_LINK');\n\n-- CreateTable\nCREATE TABLE \"EmailTemplate\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"content\" JSONB NOT NULL,\n    \"type\" \"EmailTemplateType\" NOT NULL,\n    \"subject\" TEXT NOT NULL,\n\n    CONSTRAINT \"EmailTemplate_pkey\" PRIMARY KEY (\"projectConfigId\",\"type\")\n);\n\n-- AddForeignKey\nALTER TABLE \"EmailTemplate\" ADD CONSTRAINT \"EmailTemplate_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"EmailServiceConfig\"(\"projectConfigId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240529121811_spotify_oauth",
    "sql": "-- AlterEnum\nALTER TYPE \"ProxiedOAuthProviderType\" ADD VALUE 'SPOTIFY';\n\n-- AlterEnum\nALTER TYPE \"StandardOAuthProviderType\" ADD VALUE 'SPOTIFY';\n"
  },
  {
    "name": "20240608142105_oauth_access_token",
    "sql": "/*\n  Warnings:\n\n  - You are about to drop the column `providerRefreshToken` on the `ProjectUserOAuthAccount` table. All the data in the column will be lost.\n  - You are about to drop the column `tenantId` on the `StandardOAuthProviderConfig` table. All the data in the column will be lost.\n\n*/\n-- AlterTable\nALTER TABLE \"ProjectUserAuthorizationCode\" ADD COLUMN     \"afterCallbackRedirectUrl\" TEXT;\n\n-- AlterTable\nALTER TABLE \"ProjectUserOAuthAccount\" DROP COLUMN \"providerRefreshToken\";\n\n-- AlterTable\nALTER TABLE \"StandardOAuthProviderConfig\" DROP COLUMN \"tenantId\";\n\n-- CreateTable\nCREATE TABLE \"OAuthToken\" (\n    \"id\" UUID NOT NULL,\n    \"projectId\" TEXT NOT NULL,\n    \"oAuthProviderConfigId\" TEXT NOT NULL,\n    \"providerAccountId\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"refreshToken\" TEXT NOT NULL,\n    \"scopes\" TEXT[],\n\n    CONSTRAINT \"OAuthToken_pkey\" PRIMARY KEY (\"id\")\n);\n\n-- AddForeignKey\nALTER TABLE \"OAuthToken\" ADD CONSTRAINT \"OAuthToken_projectId_oAuthProviderConfigId_providerAccount_fkey\" FOREIGN KEY (\"projectId\", \"oAuthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240610085756_outer_oauth_info",
    "sql": "-- CreateTable\nCREATE TABLE \"OAuthOuterInfo\" (\n    \"id\" UUID NOT NULL,\n    \"info\" JSONB NOT NULL,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"OAuthOuterInfo_pkey\" PRIMARY KEY (\"id\")\n);\n"
  },
  {
    "name": "20240618150845_system_team_permission",
    "sql": "/*\n  Warnings:\n\n  - The primary key for the `TeamMemberDirectPermission` table will be changed. If it partially fails, the table could be left without primary key constraint.\n  - A unique constraint covering the columns `[projectId,projectUserId,teamId,permissionDbId]` on the table `TeamMemberDirectPermission` will be added. If there are existing duplicate values, this will fail.\n  - A unique constraint covering the columns `[projectId,projectUserId,teamId,systemPermission]` on the table `TeamMemberDirectPermission` will be added. If there are existing duplicate values, this will fail.\n  - The required column `id` was added to the `TeamMemberDirectPermission` table with a prisma-level default value. This is not possible if the table is not empty. Please add this column as optional, then populate it before making it required.\n\n*/\n-- CreateEnum\nCREATE TYPE \"TeamSystemPermission\" AS ENUM ('UPDATE_TEAM', 'DELETE_TEAM', 'READ_MEMBERS', 'REMOVE_MEMBERS', 'INVITE_MEMBERS');\n\n-- AlterTable\nALTER TABLE \"Permission\" ADD COLUMN     \"isDefaultTeamCreatorPermission\" BOOLEAN NOT NULL DEFAULT false,\nADD COLUMN     \"isDefaultTeamMemberPermission\" BOOLEAN NOT NULL DEFAULT false;\n\n-- AlterTable\nALTER TABLE \"PermissionEdge\" ADD COLUMN     \"parentTeamSystemPermission\" \"TeamSystemPermission\",\nALTER COLUMN \"parentPermissionDbId\" DROP NOT NULL;\n\n-- AlterTable\nALTER TABLE \"ProjectConfig\" ADD COLUMN     \"teamCreateDefaultSystemPermissions\" \"TeamSystemPermission\"[],\nADD COLUMN     \"teamMemberDefaultSystemPermissions\" \"TeamSystemPermission\"[];\n\n\n-- -- AlterTable\n-- ALTER TABLE \"TeamMemberDirectPermission\" DROP CONSTRAINT \"TeamMemberDirectPermission_pkey\",\n-- ADD COLUMN     \"id\" UUID NOT NULL,\n-- ADD COLUMN     \"systemPermission\" \"TeamSystemPermission\",\n-- ALTER COLUMN \"permissionDbId\" DROP NOT NULL,\n-- ADD CONSTRAINT \"TeamMemberDirectPermission_pkey\" PRIMARY KEY (\"id\");\n\n-- -- CreateIndex\n-- CREATE UNIQUE INDEX \"TeamMemberDirectPermission_projectId_projectUserId_teamId_p_key\" ON \"TeamMemberDirectPermission\"(\"projectId\", \"projectUserId\", \"teamId\", \"permissionDbId\");\n\n-- -- CreateIndex\n-- CREATE UNIQUE INDEX \"TeamMemberDirectPermission_projectId_projectUserId_teamId_s_key\" ON \"TeamMemberDirectPermission\"(\"projectId\", \"projectUserId\", \"teamId\", \"systemPermission\");\n\n\n-- Step 1: Add `id` as an optional column\nALTER TABLE \"TeamMemberDirectPermission\" \nADD COLUMN \"id\" UUID, \nADD COLUMN \"systemPermission\" \"TeamSystemPermission\";\n\n-- Step 2: Populate the `id` column with UUID values\nUPDATE \"TeamMemberDirectPermission\" SET \"id\" = gen_random_uuid();\n\n-- Step 3: Make the `id` column required\nALTER TABLE \"TeamMemberDirectPermission\" ALTER COLUMN \"id\" SET NOT NULL;\n\n-- Step 4: Ensure there are no duplicate values for the unique constraints\n-- There should be no duplicates for the unique constraints\n\n-- Step 5: Drop the existing primary key constraint\nALTER TABLE \"TeamMemberDirectPermission\" DROP CONSTRAINT \"TeamMemberDirectPermission_pkey\",\nALTER COLUMN \"permissionDbId\" DROP NOT NULL;\n\n-- Step 6: Add the unique constraints\nCREATE UNIQUE INDEX \"TeamMemberDirectPermission_projectId_projectUserId_teamId_p_key\" ON \"TeamMemberDirectPermission\"(\"projectId\", \"projectUserId\", \"teamId\", \"permissionDbId\");\nCREATE UNIQUE INDEX \"TeamMemberDirectPermission_projectId_projectUserId_teamId_s_key\" ON \"TeamMemberDirectPermission\"(\"projectId\", \"projectUserId\", \"teamId\", \"systemPermission\");\n\n-- Step 7: Add the new primary key constraint\nALTER TABLE \"TeamMemberDirectPermission\" ADD CONSTRAINT \"TeamMemberDirectPermission_pkey\" PRIMARY KEY (\"id\");"
  },
  {
    "name": "20240701161229_fix_selected_team_and_added_ondelete",
    "sql": "/*\n  Warnings:\n\n  - You are about to drop the column `selectedTeamId` on the `ProjectUser` table. All the data in the column will be lost.\n  - A unique constraint covering the columns `[projectId,projectUserId,isSelected]` on the table `TeamMember` will be added. If there are existing duplicate values, this will fail.\n\n*/\n-- CreateEnum\nCREATE TYPE \"BooleanTrue\" AS ENUM ('TRUE');\n\n-- DropForeignKey\nALTER TABLE \"ApiKeySet\" DROP CONSTRAINT \"ApiKeySet_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"OAuthToken\" DROP CONSTRAINT \"OAuthToken_projectId_oAuthProviderConfigId_providerAccount_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"Permission\" DROP CONSTRAINT \"Permission_projectId_teamId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUser\" DROP CONSTRAINT \"ProjectUser_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUser\" DROP CONSTRAINT \"ProjectUser_projectId_selectedTeamId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"Team\" DROP CONSTRAINT \"Team_projectId_fkey\";\n\n-- AlterTable\nALTER TABLE \"ProjectUser\" DROP COLUMN \"selectedTeamId\";\n\n-- AlterTable\nALTER TABLE \"TeamMember\" ADD COLUMN     \"isSelected\" \"BooleanTrue\";\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"TeamMember_projectId_projectUserId_isSelected_key\" ON \"TeamMember\"(\"projectId\", \"projectUserId\", \"isSelected\");\n\n-- AddForeignKey\nALTER TABLE \"Team\" ADD CONSTRAINT \"Team_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"Permission\" ADD CONSTRAINT \"Permission_projectId_teamId_fkey\" FOREIGN KEY (\"projectId\", \"teamId\") REFERENCES \"Team\"(\"projectId\", \"teamId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUser\" ADD CONSTRAINT \"ProjectUser_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthToken\" ADD CONSTRAINT \"OAuthToken_projectId_oAuthProviderConfigId_providerAccount_fkey\" FOREIGN KEY (\"projectId\", \"oAuthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ApiKeySet\" ADD CONSTRAINT \"ApiKeySet_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240702050143_verification_codes",
    "sql": "-- CreateEnum\nCREATE TYPE \"VerificationCodeType\" AS ENUM ('ONE_TIME_PASSWORD');\n\n-- CreateTable\nCREATE TABLE \"VerificationCode\" (\n    \"projectId\" TEXT NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"type\" \"VerificationCodeType\" NOT NULL,\n    \"code\" TEXT NOT NULL,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n    \"usedAt\" TIMESTAMP(3),\n    \"redirectUrl\" TEXT,\n    \"email\" TEXT NOT NULL,\n    \"data\" JSONB NOT NULL,\n\n    CONSTRAINT \"VerificationCode_pkey\" PRIMARY KEY (\"projectId\",\"id\")\n);\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"VerificationCode_projectId_code_key\" ON \"VerificationCode\"(\"projectId\", \"code\");\n"
  },
  {
    "name": "20240707043509_team_profile_image",
    "sql": "-- AlterTable\nALTER TABLE \"Team\" ADD COLUMN     \"profileImageUrl\" TEXT;\n"
  },
  {
    "name": "20240714031259_more_backend_endpoints",
    "sql": "/*\n  Warnings:\n\n  - A unique constraint covering the columns `[innerState]` on the table `OAuthOuterInfo` will be added. If there are existing duplicate values, this will fail.\n  - Added the required column `innerState` to the `OAuthOuterInfo` table without a default value. This is not possible if the table is not empty.\n\n*/\n-- AlterEnum\nALTER TYPE \"VerificationCodeType\" ADD VALUE 'CONTACT_CHANNEL_VERIFICATION';\n\n-- DropForeignKey\nALTER TABLE \"EmailServiceConfig\" DROP CONSTRAINT \"EmailServiceConfig_projectConfigId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"EmailTemplate\" DROP CONSTRAINT \"EmailTemplate_projectConfigId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectDomain\" DROP CONSTRAINT \"ProjectDomain_projectConfigId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProxiedEmailServiceConfig\" DROP CONSTRAINT \"ProxiedEmailServiceConfig_projectConfigId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"StandardEmailServiceConfig\" DROP CONSTRAINT \"StandardEmailServiceConfig_projectConfigId_fkey\";\n\n-- AlterTable\nALTER TABLE \"OAuthOuterInfo\" ADD COLUMN     \"innerState\" TEXT;\n\n-- BEGIN MANUALLY MODIFIED: Fill in the innerState column with the innerState value from the info json\nUPDATE \"OAuthOuterInfo\" SET \"innerState\" = \"info\"->>'innerState';\nALTER TABLE \"OAuthOuterInfo\" ALTER COLUMN \"innerState\" SET NOT NULL;\n-- END MANUALLY MODIFIED\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"OAuthOuterInfo_innerState_key\" ON \"OAuthOuterInfo\"(\"innerState\");\n\n-- AddForeignKey\nALTER TABLE \"ProjectDomain\" ADD CONSTRAINT \"ProjectDomain_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"EmailServiceConfig\" ADD CONSTRAINT \"EmailServiceConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"EmailTemplate\" ADD CONSTRAINT \"EmailTemplate_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"EmailServiceConfig\"(\"projectConfigId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProxiedEmailServiceConfig\" ADD CONSTRAINT \"ProxiedEmailServiceConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"EmailServiceConfig\"(\"projectConfigId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"StandardEmailServiceConfig\" ADD CONSTRAINT \"StandardEmailServiceConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"EmailServiceConfig\"(\"projectConfigId\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240722004703_events",
    "sql": "-- CreateTable\nCREATE TABLE \"Event\" (\n    \"id\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"isWide\" BOOLEAN NOT NULL,\n    \"eventStartedAt\" TIMESTAMP(3) NOT NULL,\n    \"eventEndedAt\" TIMESTAMP(3) NOT NULL,\n    \"systemEventTypeIds\" TEXT[],\n    \"data\" JSONB NOT NULL,\n\n    CONSTRAINT \"Event_pkey\" PRIMARY KEY (\"id\")\n);\n"
  },
  {
    "name": "20240725161939_team_profiles",
    "sql": "-- AlterTable\nALTER TABLE \"TeamMember\" ADD COLUMN     \"displayName\" TEXT,\nADD COLUMN     \"profileImageUrl\" TEXT;\n"
  },
  {
    "name": "20240726225154_facebook_config_id",
    "sql": "-- AlterTable\nALTER TABLE \"StandardOAuthProviderConfig\" ADD COLUMN     \"facebookConfigId\" TEXT;\n"
  },
  {
    "name": "20240730175523_oauth_access_token",
    "sql": "-- CreateTable\nCREATE TABLE \"OAuthAccessToken\" (\n    \"id\" UUID NOT NULL,\n    \"projectId\" TEXT NOT NULL,\n    \"oAuthProviderConfigId\" TEXT NOT NULL,\n    \"providerAccountId\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"accessToken\" TEXT NOT NULL,\n    \"scopes\" TEXT[],\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"OAuthAccessToken_pkey\" PRIMARY KEY (\"id\")\n);\n\n-- AddForeignKey\nALTER TABLE \"OAuthAccessToken\" ADD CONSTRAINT \"OAuthAccessToken_projectId_oAuthProviderConfigId_providerA_fkey\" FOREIGN KEY (\"projectId\", \"oAuthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240802011240_password_reset_verification",
    "sql": "-- AlterEnum\nALTER TYPE \"VerificationCodeType\" ADD VALUE 'PASSWORD_RESET';\n"
  },
  {
    "name": "20240804210316_team_invitation",
    "sql": "-- AlterEnum\nALTER TYPE \"EmailTemplateType\" ADD VALUE 'TEAM_INVITATION';\n\n-- AlterEnum\nALTER TYPE \"VerificationCodeType\" ADD VALUE 'TEAM_INVITATION';\n"
  },
  {
    "name": "20240809231417_disable_sign_up",
    "sql": "-- AlterTable\nALTER TABLE \"ProjectConfig\" ADD COLUMN     \"signUpEnabled\" BOOLEAN NOT NULL DEFAULT true;\n"
  },
  {
    "name": "20240810052738_multi_factor_authentication",
    "sql": "/*\n  Warnings:\n\n  - You are about to drop the column `email` on the `VerificationCode` table. All the data in the column will be lost.\n\n*/\n-- AlterEnum\nALTER TYPE \"VerificationCodeType\" ADD VALUE 'MFA_ATTEMPT';\n\n-- AlterTable\nALTER TABLE \"ProjectUser\" ADD COLUMN     \"requiresTotpMfa\" BOOLEAN NOT NULL DEFAULT false,\nADD COLUMN     \"totpSecret\" BYTEA;\n\n-- AlterTable\nALTER TABLE \"VerificationCode\" DROP COLUMN \"email\",\nADD COLUMN     \"method\" JSONB NOT NULL DEFAULT 'null';\n"
  },
  {
    "name": "20240811194548_client_team_creation",
    "sql": "-- AlterTable\nALTER TABLE \"ProjectConfig\" ADD COLUMN \"clientTeamCreationEnabled\" BOOLEAN NOT NULL DEFAULT false;\n\n-- Update existing rows\nUPDATE \"ProjectConfig\" SET \"clientTeamCreationEnabled\" = false;\n\n-- Remove the default constraint\nALTER TABLE \"ProjectConfig\" ALTER COLUMN \"clientTeamCreationEnabled\" DROP DEFAULT;"
  },
  {
    "name": "20240812013545_project_on_delete",
    "sql": "-- DropForeignKey\nALTER TABLE \"OAuthProviderConfig\" DROP CONSTRAINT \"OAuthProviderConfig_projectConfigId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"Permission\" DROP CONSTRAINT \"Permission_projectConfigId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"Project\" DROP CONSTRAINT \"Project_configId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectConfigOverride\" DROP CONSTRAINT \"ProjectConfigOverride_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" DROP CONSTRAINT \"ProjectUserOAuthAccount_projectConfigId_oauthProviderConfi_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProxiedOAuthProviderConfig\" DROP CONSTRAINT \"ProxiedOAuthProviderConfig_projectConfigId_id_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"StandardOAuthProviderConfig\" DROP CONSTRAINT \"StandardOAuthProviderConfig_projectConfigId_id_fkey\";\n\n-- AddForeignKey\nALTER TABLE \"Project\" ADD CONSTRAINT \"Project_configId_fkey\" FOREIGN KEY (\"configId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectConfigOverride\" ADD CONSTRAINT \"ProjectConfigOverride_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"Permission\" ADD CONSTRAINT \"Permission_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" ADD CONSTRAINT \"ProjectUserOAuthAccount_projectConfigId_oauthProviderConfi_fkey\" FOREIGN KEY (\"projectConfigId\", \"oauthProviderConfigId\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthProviderConfig\" ADD CONSTRAINT \"OAuthProviderConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProxiedOAuthProviderConfig\" ADD CONSTRAINT \"ProxiedOAuthProviderConfig_projectConfigId_id_fkey\" FOREIGN KEY (\"projectConfigId\", \"id\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"StandardOAuthProviderConfig\" ADD CONSTRAINT \"StandardOAuthProviderConfig_projectConfigId_id_fkey\" FOREIGN KEY (\"projectConfigId\", \"id\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240815125620_discord_oauth",
    "sql": "-- AlterEnum\nALTER TYPE \"StandardOAuthProviderType\" ADD VALUE 'DISCORD';\n"
  },
  {
    "name": "20240820045300_client_read_only_metadata",
    "sql": "-- AlterTable\nALTER TABLE \"ProjectUser\" ADD COLUMN     \"clientReadOnlyMetadata\" JSONB;\n\n-- AlterTable\nALTER TABLE \"Team\" ADD COLUMN     \"clientMetadata\" JSONB,\nADD COLUMN     \"clientReadOnlyMetadata\" JSONB,\nADD COLUMN     \"serverMetadata\" JSONB;\n"
  },
  {
    "name": "20240823172201_gitlab_oauth",
    "sql": "-- AlterEnum\nALTER TYPE \"StandardOAuthProviderType\" ADD VALUE 'GITLAB';\n"
  },
  {
    "name": "20240830010429_event_index",
    "sql": "-- CreateIndex\nCREATE INDEX \"Event_data_idx\" ON \"Event\" USING GIN (\"data\" jsonb_path_ops);\n"
  },
  {
    "name": "20240901224341_connected_account",
    "sql": "/*\n  Warnings:\n\n  - You are about to drop the column `enabled` on the `OAuthProviderConfig` table. All the data in the column will be lost.\n  - You are about to drop the column `credentialEnabled` on the `ProjectConfig` table. All the data in the column will be lost.\n  - You are about to drop the column `magicLinkEnabled` on the `ProjectConfig` table. All the data in the column will be lost.\n  - You are about to drop the column `authWithEmail` on the `ProjectUser` table. All the data in the column will be lost.\n  - You are about to drop the column `passwordHash` on the `ProjectUser` table. All the data in the column will be lost.\n  - You are about to drop the column `primaryEmail` on the `ProjectUser` table. All the data in the column will be lost.\n  - You are about to drop the column `primaryEmailVerified` on the `ProjectUser` table. All the data in the column will be lost.\n  - You are about to drop the `ProjectUserEmailVerificationCode` table. If the table is not empty, all the data it contains will be lost.\n  - You are about to drop the `ProjectUserMagicLinkCode` table. If the table is not empty, all the data it contains will be lost.\n  - You are about to drop the `ProjectUserPasswordResetCode` table. If the table is not empty, all the data it contains will be lost.\n  - A unique constraint covering the columns `[projectConfigId,authMethodConfigId]` on the table `OAuthProviderConfig` will be added. If there are existing duplicate values, this will fail.\n  - A unique constraint covering the columns `[projectConfigId,connectedAccountConfigId]` on the table `OAuthProviderConfig` will be added. If there are existing duplicate values, this will fail.\n  - A unique constraint covering the columns `[projectConfigId,clientId]` on the table `StandardOAuthProviderConfig` will be added. If there are existing duplicate values, this will fail.\n\n*/\n\n\n\n-- Step 1: Drop constraints and foreign keys\n-- DropForeignKey\nALTER TABLE \"OAuthProviderConfig\" DROP CONSTRAINT \"OAuthProviderConfig_projectConfigId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserEmailVerificationCode\" DROP CONSTRAINT \"ProjectUserEmailVerificationCode_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserMagicLinkCode\" DROP CONSTRAINT \"ProjectUserMagicLinkCode_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" DROP CONSTRAINT \"ProjectUserOAuthAccount_projectConfigId_oauthProviderConfi_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserPasswordResetCode\" DROP CONSTRAINT \"ProjectUserPasswordResetCode_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"StandardOAuthProviderConfig\" DROP CONSTRAINT \"StandardOAuthProviderConfig_projectConfigId_id_fkey\";\n\n\n\n\n\n-- Step 2: Create new stuff\n\n-- CreateEnum\nCREATE TYPE \"ContactChannelType\" AS ENUM ('EMAIL');\n\n-- CreateEnum\nCREATE TYPE \"PasswordAuthMethodIdentifierType\" AS ENUM ('EMAIL');\n\n\n-- CreateTable\nCREATE TABLE \"ContactChannel\" (\n    \"projectId\" TEXT NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"type\" \"ContactChannelType\" NOT NULL,\n    \"isPrimary\" \"BooleanTrue\",\n    \"isVerified\" BOOLEAN NOT NULL,\n    \"value\" TEXT NOT NULL,\n\n    CONSTRAINT \"ContactChannel_pkey\" PRIMARY KEY (\"projectId\",\"projectUserId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"ConnectedAccountConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"enabled\" BOOLEAN NOT NULL DEFAULT true,\n\n    CONSTRAINT \"ConnectedAccountConfig_pkey\" PRIMARY KEY (\"projectConfigId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"ConnectedAccount\" (\n    \"projectId\" TEXT NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"projectConfigId\" UUID NOT NULL,\n    \"connectedAccountConfigId\" UUID NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"oauthProviderConfigId\" TEXT NOT NULL,\n    \"providerAccountId\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"ConnectedAccount_pkey\" PRIMARY KEY (\"projectId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"AuthMethodConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"enabled\" BOOLEAN NOT NULL DEFAULT true,\n\n    CONSTRAINT \"AuthMethodConfig_pkey\" PRIMARY KEY (\"projectConfigId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"OtpAuthMethodConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"authMethodConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"contactChannelType\" \"ContactChannelType\" NOT NULL,\n\n    CONSTRAINT \"OtpAuthMethodConfig_pkey\" PRIMARY KEY (\"projectConfigId\",\"authMethodConfigId\")\n);\n\n-- CreateTable\nCREATE TABLE \"PasswordAuthMethodConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"authMethodConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"identifierType\" \"PasswordAuthMethodIdentifierType\" NOT NULL,\n\n    CONSTRAINT \"PasswordAuthMethodConfig_pkey\" PRIMARY KEY (\"projectConfigId\",\"authMethodConfigId\")\n);\n\n-- CreateTable\nCREATE TABLE \"AuthMethod\" (\n    \"projectId\" TEXT NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"authMethodConfigId\" UUID NOT NULL,\n    \"projectConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"AuthMethod_pkey\" PRIMARY KEY (\"projectId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"OtpAuthMethod\" (\n    \"projectId\" TEXT NOT NULL,\n    \"authMethodId\" UUID NOT NULL,\n    \"contactChannelId\" UUID NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"OtpAuthMethod_pkey\" PRIMARY KEY (\"projectId\",\"authMethodId\")\n);\n\n-- CreateTable\nCREATE TABLE \"PasswordAuthMethod\" (\n    \"projectId\" TEXT NOT NULL,\n    \"authMethodId\" UUID NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"identifierType\" \"PasswordAuthMethodIdentifierType\" NOT NULL,\n    \"identifier\" TEXT NOT NULL,\n    \"passwordHash\" TEXT NOT NULL,\n\n    CONSTRAINT \"PasswordAuthMethod_pkey\" PRIMARY KEY (\"projectId\",\"authMethodId\")\n);\n\n-- CreateTable\nCREATE TABLE \"OAuthAuthMethod\" (\n    \"projectId\" TEXT NOT NULL,\n    \"projectConfigId\" UUID NOT NULL,\n    \"authMethodId\" UUID NOT NULL,\n    \"oauthProviderConfigId\" TEXT NOT NULL,\n    \"providerAccountId\" TEXT NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"OAuthAuthMethod_pkey\" PRIMARY KEY (\"projectId\",\"authMethodId\")\n);\n\n-- AlterTable\nALTER TABLE \"OAuthProviderConfig\" ADD COLUMN     \"authMethodConfigId\" UUID,\nADD COLUMN     \"connectedAccountConfigId\" UUID;\n\n\n\n\n\n\n\n\n\n-- Step 3: Custom migrations\n\n-- previously, all OAuthProviderConfig were AuthMethods and ConnectedAccountConfigs implicitly\n-- this is now explicit, so set the authMethodConfigId and connectedAccountConfigId to newly created objects\n-- Set authMethodConfigId and connectedAccountConfigId to unique UUIDs for each row\nUPDATE \"OAuthProviderConfig\"\n    SET \"authMethodConfigId\" = gen_random_uuid();\nUPDATE \"OAuthProviderConfig\"\n    SET \"connectedAccountConfigId\" = gen_random_uuid()\n    FROM \"StandardOAuthProviderConfig\"\n    WHERE \"OAuthProviderConfig\".\"projectConfigId\" = \"StandardOAuthProviderConfig\".\"projectConfigId\" AND \"OAuthProviderConfig\".\"id\" = \"StandardOAuthProviderConfig\".\"id\";\n\nINSERT INTO \"AuthMethodConfig\" (\"projectConfigId\", \"id\", \"createdAt\", \"updatedAt\", \"enabled\")\n    SELECT \"projectConfigId\", \"authMethodConfigId\", \"createdAt\", \"updatedAt\", \"enabled\" FROM \"OAuthProviderConfig\";\nINSERT INTO \"ConnectedAccountConfig\" (\"projectConfigId\", \"id\", \"createdAt\", \"updatedAt\", \"enabled\")\n    SELECT \"projectConfigId\", \"connectedAccountConfigId\", \"createdAt\", \"updatedAt\", \"enabled\"\n        FROM \"OAuthProviderConfig\"\n        WHERE \"connectedAccountConfigId\" IS NOT NULL;\n\n\n-- previously, we had credentialEnabled and magicLinkEnabled on ProjectConfig\n-- now, we have PasswordAuthMethodConfig and OtpAuthMethodConfig\nINSERT INTO \"PasswordAuthMethodConfig\" (\"projectConfigId\", \"authMethodConfigId\", \"createdAt\", \"updatedAt\", \"identifierType\")\n    SELECT \"id\", gen_random_uuid(), \"createdAt\", \"updatedAt\", 'EMAIL'\n    FROM \"ProjectConfig\";\nINSERT INTO \"AuthMethodConfig\" (\"projectConfigId\", \"id\", \"createdAt\", \"updatedAt\", \"enabled\")\n    SELECT \"projectConfigId\", \"authMethodConfigId\", \"PasswordAuthMethodConfig\".\"createdAt\", \"PasswordAuthMethodConfig\".\"updatedAt\", (\"ProjectConfig\".\"credentialEnabled\" = true)\n    FROM \"PasswordAuthMethodConfig\"\n    LEFT JOIN \"ProjectConfig\" ON \"PasswordAuthMethodConfig\".\"projectConfigId\" = \"ProjectConfig\".\"id\";\n\nINSERT INTO \"OtpAuthMethodConfig\" (\"projectConfigId\", \"authMethodConfigId\", \"createdAt\", \"updatedAt\", \"contactChannelType\")\n    SELECT \"id\", gen_random_uuid(), \"createdAt\", \"updatedAt\", 'EMAIL'\n    FROM \"ProjectConfig\";\nINSERT INTO \"AuthMethodConfig\" (\"projectConfigId\", \"id\", \"createdAt\", \"updatedAt\", \"enabled\")\n    SELECT \"projectConfigId\", \"authMethodConfigId\", \"OtpAuthMethodConfig\".\"createdAt\", \"OtpAuthMethodConfig\".\"updatedAt\", (\"ProjectConfig\".\"magicLinkEnabled\" = true)\n    FROM \"OtpAuthMethodConfig\"\n    LEFT JOIN \"ProjectConfig\" ON \"OtpAuthMethodConfig\".\"projectConfigId\" = \"ProjectConfig\".\"id\";\n\n\n-- previously, we had primaryEmail and primaryEmailVerified on ProjectUser\n-- now, we have ContactChannel\nINSERT INTO \"ContactChannel\" (\"projectId\", \"projectUserId\", \"id\", \"createdAt\", \"updatedAt\", \"type\", \"isPrimary\", \"isVerified\", \"value\")\n    SELECT \"projectId\", \"projectUserId\", gen_random_uuid(), \"createdAt\", \"updatedAt\", 'EMAIL', 'TRUE', \"primaryEmailVerified\", \"primaryEmail\"\n    FROM \"ProjectUser\"\n    WHERE \"primaryEmail\" IS NOT NULL;\n\n\n-- previously, we had authWithEmail, passwordHash, and primaryEmail on ProjectUser\n-- now, we have PasswordAuthMethod and OtpAuthMethod\nINSERT INTO \"PasswordAuthMethod\" (\"projectId\", \"authMethodId\", \"projectUserId\", \"createdAt\", \"updatedAt\", \"identifierType\", \"identifier\", \"passwordHash\")\n    SELECT \"projectId\", gen_random_uuid(), \"projectUserId\", \"createdAt\", \"updatedAt\", 'EMAIL', \"primaryEmail\", \"passwordHash\"\n    FROM \"ProjectUser\"\n    WHERE \"authWithEmail\" = true AND \"passwordHash\" IS NOT NULL;\nINSERT INTO \"AuthMethod\" (\"projectId\", \"id\", \"projectUserId\", \"authMethodConfigId\", \"projectConfigId\", \"createdAt\", \"updatedAt\")\n    SELECT \"projectId\", \"authMethodId\", \"projectUserId\", \"PasswordAuthMethodConfig\".\"authMethodConfigId\", \"projectConfigId\", \"PasswordAuthMethod\".\"createdAt\", \"PasswordAuthMethod\".\"updatedAt\"\n    FROM \"PasswordAuthMethod\"\n    LEFT JOIN \"Project\" ON \"PasswordAuthMethod\".\"projectId\" = \"Project\".\"id\"\n    LEFT JOIN \"ProjectConfig\" ON \"Project\".\"configId\" = \"ProjectConfig\".\"id\"\n    LEFT JOIN \"PasswordAuthMethodConfig\" ON \"ProjectConfig\".\"id\" = \"PasswordAuthMethodConfig\".\"projectConfigId\";\n\n\nINSERT INTO \"OtpAuthMethod\" (\"projectId\", \"authMethodId\", \"projectUserId\", \"createdAt\", \"updatedAt\", \"contactChannelId\")\n    SELECT \"ProjectUser\".\"projectId\", gen_random_uuid(), \"ProjectUser\".\"projectUserId\", \"ProjectUser\".\"createdAt\", \"ProjectUser\".\"updatedAt\", \"ContactChannel\".\"id\"\n    FROM \"ProjectUser\"\n    LEFT JOIN \"ContactChannel\" ON \"ProjectUser\".\"projectId\" = \"ContactChannel\".\"projectId\" AND \"ProjectUser\".\"projectUserId\" = \"ContactChannel\".\"projectUserId\" AND \"ContactChannel\".\"isPrimary\" = 'TRUE'\n    WHERE \"authWithEmail\" = true;\nINSERT INTO \"AuthMethod\" (\"projectId\", \"id\", \"projectUserId\", \"authMethodConfigId\", \"projectConfigId\", \"createdAt\", \"updatedAt\")\n    SELECT \"projectId\", \"authMethodId\", \"projectUserId\", \"OtpAuthMethodConfig\".\"authMethodConfigId\", \"projectConfigId\", \"OtpAuthMethod\".\"createdAt\", \"OtpAuthMethod\".\"updatedAt\"\n    FROM \"OtpAuthMethod\"\n    LEFT JOIN \"Project\" ON \"OtpAuthMethod\".\"projectId\" = \"Project\".\"id\"\n    LEFT JOIN \"ProjectConfig\" ON \"Project\".\"configId\" = \"ProjectConfig\".\"id\"\n    LEFT JOIN \"OtpAuthMethodConfig\" ON \"ProjectConfig\".\"id\" = \"OtpAuthMethodConfig\".\"projectConfigId\";\n\n\n\n\n\n-- Step 4: Drop stuff\n\n-- AlterTable\nALTER TABLE \"OAuthProviderConfig\" DROP COLUMN \"enabled\";\n\n-- AlterTable\nALTER TABLE \"ProjectConfig\" DROP COLUMN \"credentialEnabled\",\nDROP COLUMN \"magicLinkEnabled\";\n\n-- AlterTable\nALTER TABLE \"ProjectUser\" DROP COLUMN \"authWithEmail\",\nDROP COLUMN \"passwordHash\",\nDROP COLUMN \"primaryEmail\",\nDROP COLUMN \"primaryEmailVerified\";\n\n-- DropTable\nDROP TABLE \"ProjectUserEmailVerificationCode\";\n\n-- DropTable\nDROP TABLE \"ProjectUserMagicLinkCode\";\n\n-- DropTable\nDROP TABLE \"ProjectUserPasswordResetCode\";\n\n\n\n\n-- Step 5: Add foreign keys and indices \n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ContactChannel_projectId_projectUserId_type_isPrimary_key\" ON \"ContactChannel\"(\"projectId\", \"projectUserId\", \"type\", \"isPrimary\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ContactChannel_projectId_projectUserId_type_value_key\" ON \"ContactChannel\"(\"projectId\", \"projectUserId\", \"type\", \"value\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ConnectedAccount_projectId_oauthProviderConfigId_providerAc_key\" ON \"ConnectedAccount\"(\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"OtpAuthMethod_projectId_contactChannelId_key\" ON \"OtpAuthMethod\"(\"projectId\", \"contactChannelId\");\n\n-- CreateIndex\n-- CREATE UNIQUE INDEX \"PasswordAuthMethod_projectId_identifierType_identifier_key\" ON \"PasswordAuthMethod\"(\"projectId\", \"identifierType\", \"identifier\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"OAuthAuthMethod_projectId_oauthProviderConfigId_providerAcc_key\" ON \"OAuthAuthMethod\"(\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"OAuthProviderConfig_projectConfigId_authMethodConfigId_key\" ON \"OAuthProviderConfig\"(\"projectConfigId\", \"authMethodConfigId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"OAuthProviderConfig_projectConfigId_connectedAccountConfigI_key\" ON \"OAuthProviderConfig\"(\"projectConfigId\", \"connectedAccountConfigId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"StandardOAuthProviderConfig_projectConfigId_clientId_key\" ON \"StandardOAuthProviderConfig\"(\"projectConfigId\", \"clientId\");\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" ADD CONSTRAINT \"ProjectUserOAuthAccount_projectConfigId_oauthProviderConfi_fkey\" FOREIGN KEY (\"projectConfigId\", \"oauthProviderConfigId\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ContactChannel\" ADD CONSTRAINT \"ContactChannel_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ContactChannel\" ADD CONSTRAINT \"ContactChannel_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccountConfig\" ADD CONSTRAINT \"ConnectedAccountConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_projectId_oauthProviderConfigId_providerA_fkey\" FOREIGN KEY (\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_projectConfigId_connectedAccountConfigId_fkey\" FOREIGN KEY (\"projectConfigId\", \"connectedAccountConfigId\") REFERENCES \"ConnectedAccountConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_projectConfigId_oauthProviderConfigId_fkey\" FOREIGN KEY (\"projectConfigId\", \"oauthProviderConfigId\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"AuthMethodConfig\" ADD CONSTRAINT \"AuthMethodConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OtpAuthMethodConfig\" ADD CONSTRAINT \"OtpAuthMethodConfig_projectConfigId_authMethodConfigId_fkey\" FOREIGN KEY (\"projectConfigId\", \"authMethodConfigId\") REFERENCES \"AuthMethodConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasswordAuthMethodConfig\" ADD CONSTRAINT \"PasswordAuthMethodConfig_projectConfigId_authMethodConfigI_fkey\" FOREIGN KEY (\"projectConfigId\", \"authMethodConfigId\") REFERENCES \"AuthMethodConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthProviderConfig\" ADD CONSTRAINT \"OAuthProviderConfig_projectConfigId_authMethodConfigId_fkey\" FOREIGN KEY (\"projectConfigId\", \"authMethodConfigId\") REFERENCES \"AuthMethodConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthProviderConfig\" ADD CONSTRAINT \"OAuthProviderConfig_projectConfigId_connectedAccountConfig_fkey\" FOREIGN KEY (\"projectConfigId\", \"connectedAccountConfigId\") REFERENCES \"ConnectedAccountConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthProviderConfig\" ADD CONSTRAINT \"OAuthProviderConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"StandardOAuthProviderConfig\" ADD CONSTRAINT \"StandardOAuthProviderConfig_projectConfigId_id_fkey\" FOREIGN KEY (\"projectConfigId\", \"id\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"AuthMethod\" ADD CONSTRAINT \"AuthMethod_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"AuthMethod\" ADD CONSTRAINT \"AuthMethod_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"AuthMethod\" ADD CONSTRAINT \"AuthMethod_projectConfigId_authMethodConfigId_fkey\" FOREIGN KEY (\"projectConfigId\", \"authMethodConfigId\") REFERENCES \"AuthMethodConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OtpAuthMethod\" ADD CONSTRAINT \"OtpAuthMethod_projectId_projectUserId_contactChannelId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\", \"contactChannelId\") REFERENCES \"ContactChannel\"(\"projectId\", \"projectUserId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OtpAuthMethod\" ADD CONSTRAINT \"OtpAuthMethod_projectId_authMethodId_fkey\" FOREIGN KEY (\"projectId\", \"authMethodId\") REFERENCES \"AuthMethod\"(\"projectId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OtpAuthMethod\" ADD CONSTRAINT \"OtpAuthMethod_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasswordAuthMethod\" ADD CONSTRAINT \"PasswordAuthMethod_projectId_authMethodId_fkey\" FOREIGN KEY (\"projectId\", \"authMethodId\") REFERENCES \"AuthMethod\"(\"projectId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasswordAuthMethod\" ADD CONSTRAINT \"PasswordAuthMethod_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthAuthMethod\" ADD CONSTRAINT \"OAuthAuthMethod_projectId_authMethodId_fkey\" FOREIGN KEY (\"projectId\", \"authMethodId\") REFERENCES \"AuthMethod\"(\"projectId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthAuthMethod\" ADD CONSTRAINT \"OAuthAuthMethod_projectId_oauthProviderConfigId_providerAc_fkey\" FOREIGN KEY (\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"projectId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthAuthMethod\" ADD CONSTRAINT \"OAuthAuthMethod_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthAuthMethod\" ADD CONSTRAINT \"OAuthAuthMethod_projectConfigId_oauthProviderConfigId_fkey\" FOREIGN KEY (\"projectConfigId\", \"oauthProviderConfigId\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n"
  },
  {
    "name": "20240904155848_add_bitbucket_oauth",
    "sql": "-- AlterEnum\nALTER TYPE \"StandardOAuthProviderType\" ADD VALUE 'BITBUCKET';\n"
  },
  {
    "name": "20240905201445_ms_tenant",
    "sql": "-- AlterTable\nALTER TABLE \"StandardOAuthProviderConfig\" ADD COLUMN     \"microsoftTenantId\" TEXT;\n"
  },
  {
    "name": "20240909201430_project_on_delete",
    "sql": "-- DropForeignKey\nALTER TABLE \"OAuthProviderConfig\" DROP CONSTRAINT \"OAuthProviderConfig_projectConfigId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" DROP CONSTRAINT \"ProjectUserOAuthAccount_projectConfigId_oauthProviderConfi_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"StandardOAuthProviderConfig\" DROP CONSTRAINT \"StandardOAuthProviderConfig_projectConfigId_id_fkey\";\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" ADD CONSTRAINT \"ProjectUserOAuthAccount_projectConfigId_oauthProviderConfi_fkey\" FOREIGN KEY (\"projectConfigId\", \"oauthProviderConfigId\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthProviderConfig\" ADD CONSTRAINT \"OAuthProviderConfig_projectConfigId_fkey\" FOREIGN KEY (\"projectConfigId\") REFERENCES \"ProjectConfig\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"StandardOAuthProviderConfig\" ADD CONSTRAINT \"StandardOAuthProviderConfig_projectConfigId_id_fkey\" FOREIGN KEY (\"projectConfigId\", \"id\") REFERENCES \"OAuthProviderConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20240910211533_remove_shared_facebook",
    "sql": "/*\n  Warnings:\n\n  - The values [FACEBOOK] on the enum `ProxiedOAuthProviderType` will be removed. If these variants are still used in the database, this will fail.\n*/\n\n-- Update shared facebook project to be a standard oauth provider\n\n-- First, disable all the auth method configs that are shared facebook\nUPDATE \"AuthMethodConfig\"\nSET \"enabled\" = false\nWHERE \"id\" IN (\n    SELECT \"authMethodConfigId\"\n    FROM \"OAuthProviderConfig\"\n    WHERE \"id\" IN (\n        SELECT \"id\"\n        FROM \"ProxiedOAuthProviderConfig\"\n        WHERE \"type\" = 'FACEBOOK'\n    )\n);\n\n-- Second, create StandardOAuthProviderConfig entries for Facebook providers\nINSERT INTO \"StandardOAuthProviderConfig\" (\"projectConfigId\", \"id\", \"type\", \"clientId\", \"clientSecret\", \"createdAt\", \"updatedAt\")\nSELECT \n    p.\"projectConfigId\",\n    p.\"id\",\n    'FACEBOOK',\n    'client id',\n    'client secret',\n    NOW(),\n    NOW()\nFROM \"ProxiedOAuthProviderConfig\" p\nWHERE p.\"type\" = 'FACEBOOK';\n\n-- Then, delete the corresponding ProxiedOAuthProviderConfig entries\nDELETE FROM \"ProxiedOAuthProviderConfig\"\nWHERE \"type\" = 'FACEBOOK';\n\n-- AlterEnum\nCREATE TYPE \"ProxiedOAuthProviderType_new\" AS ENUM ('GITHUB', 'GOOGLE', 'MICROSOFT', 'SPOTIFY');\nALTER TABLE \"ProxiedOAuthProviderConfig\" ALTER COLUMN \"type\" TYPE \"ProxiedOAuthProviderType_new\" USING (\"type\"::text::\"ProxiedOAuthProviderType_new\");\nALTER TYPE \"ProxiedOAuthProviderType\" RENAME TO \"ProxiedOAuthProviderType_old\";\nALTER TYPE \"ProxiedOAuthProviderType_new\" RENAME TO \"ProxiedOAuthProviderType\";\nDROP TYPE \"ProxiedOAuthProviderType_old\";\n"
  },
  {
    "name": "20240912185510_password_auth_unique_key",
    "sql": "/*\n  Warnings:\n\n  - A unique constraint covering the columns `[projectId,identifierType,identifier]` on the table `PasswordAuthMethod` will be added. If there are existing duplicate values, this will fail.\n\n*/\n-- CreateIndex\nCREATE UNIQUE INDEX \"PasswordAuthMethod_projectId_identifierType_identifier_key\" ON \"PasswordAuthMethod\"(\"projectId\", \"identifierType\", \"identifier\");\n"
  },
  {
    "name": "20240912212547_linkedin_oauth",
    "sql": "-- AlterEnum\nALTER TYPE \"StandardOAuthProviderType\" ADD VALUE 'LINKEDIN';\n"
  },
  {
    "name": "20240914210306_apple_oauth",
    "sql": "-- AlterEnum\nALTER TYPE \"StandardOAuthProviderType\" ADD VALUE 'APPLE';\n"
  },
  {
    "name": "20240917182207_account_deletion",
    "sql": "-- AlterTable\nALTER TABLE \"ProjectConfig\" ADD COLUMN     \"clientUserDeletionEnabled\" BOOLEAN NOT NULL DEFAULT false;\n"
  },
  {
    "name": "20240919223009_x_and_slack_oauth",
    "sql": "-- AlterEnum\n-- This migration adds more than one value to an enum.\n-- With PostgreSQL versions 11 and earlier, this is not possible\n-- in a single migration. This can be worked around by creating\n-- multiple migrations, each migration adding only one value to\n-- the enum.\n\n\nALTER TYPE \"StandardOAuthProviderType\" ADD VALUE 'X';\n"
  },
  {
    "name": "20240923165906_otp_attempts",
    "sql": "-- AlterTable\nALTER TABLE \"VerificationCode\" ADD COLUMN     \"attemptCount\" INTEGER NOT NULL DEFAULT 0;\n"
  },
  {
    "name": "20240929194058_remove_otp_contact_channel",
    "sql": "/*\n  Warnings:\n\n  - You are about to drop the column `contactChannelId` on the `OtpAuthMethod` table. All the data in the column will be lost.\n  - You are about to drop the column `identifier` on the `PasswordAuthMethod` table. All the data in the column will be lost.\n  - A unique constraint covering the columns `[projectId,type,value,usedForAuth]` on the table `ContactChannel` will be added. If there are existing duplicate values, this will fail.\n  - You are about to drop the column `identifierType` on the `PasswordAuthMethod` table. All the data in the column will be lost.\n  - You are about to drop the column `identifierType` on the `PasswordAuthMethodConfig` table. All the data in the column will be lost.\n\n*/\n-- DropForeignKey\nALTER TABLE \"OtpAuthMethod\" DROP CONSTRAINT \"OtpAuthMethod_projectId_projectUserId_contactChannelId_fkey\";\n\n-- DropIndex\nDROP INDEX \"OtpAuthMethod_projectId_contactChannelId_key\";\n\n-- DropIndex\nDROP INDEX \"PasswordAuthMethod_projectId_identifierType_identifier_key\";\n\n-- AlterTable\nALTER TABLE \"ContactChannel\" ADD COLUMN \"usedForAuth\" \"BooleanTrue\";\n\n-- Set the usedForAuth value to \"TRUE\" if the contact channel is used in `OtpAuthMethod` or the value is the same as the `PasswordAuthMethod` of the same user\nUPDATE \"ContactChannel\" cc\nSET \"usedForAuth\" = 'TRUE'\nWHERE EXISTS (\n    SELECT 1\n    FROM \"OtpAuthMethod\" oam\n    WHERE oam.\"projectId\" = cc.\"projectId\"\n    AND oam.\"projectUserId\" = cc.\"projectUserId\"\n)\nOR EXISTS (\n    SELECT 1\n    FROM \"PasswordAuthMethod\" pam\n    WHERE pam.\"projectId\" = cc.\"projectId\"\n    AND pam.\"projectUserId\" = cc.\"projectUserId\"\n    AND pam.\"identifier\" = cc.\"value\"\n);\n\n\n-- AlterTable\nALTER TABLE \"OtpAuthMethod\" DROP COLUMN \"contactChannelId\";\n\n-- AlterTable\nALTER TABLE \"PasswordAuthMethod\" DROP COLUMN \"identifier\";\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ContactChannel_projectId_type_value_usedForAuth_key\" ON \"ContactChannel\"(\"projectId\", \"type\", \"value\", \"usedForAuth\");\n\n-- AlterTable\nALTER TABLE \"PasswordAuthMethod\" DROP COLUMN \"identifierType\";\n\n-- AlterTable\nALTER TABLE \"PasswordAuthMethodConfig\" DROP COLUMN \"identifierType\";\n\n-- DropEnum\nDROP TYPE \"PasswordAuthMethodIdentifierType\";\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"OtpAuthMethod_projectId_projectUserId_key\" ON \"OtpAuthMethod\"(\"projectId\", \"projectUserId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"PasswordAuthMethod_projectId_projectUserId_key\" ON \"PasswordAuthMethod\"(\"projectId\", \"projectUserId\");\n\n"
  },
  {
    "name": "20241007162201_legacy_jwt",
    "sql": "-- AlterTable\nALTER TABLE \"ProjectConfig\" ADD COLUMN     \"legacyGlobalJwtSigning\" BOOLEAN NOT NULL DEFAULT false;\n\n-- Update existing rows\nUPDATE \"ProjectConfig\" SET \"legacyGlobalJwtSigning\" = true;"
  },
  {
    "name": "20241013185548_remove_client_id_unique",
    "sql": "-- DropIndex\nDROP INDEX \"StandardOAuthProviderConfig_projectConfigId_clientId_key\";\n"
  },
  {
    "name": "20241024234115_passkey_support",
    "sql": "-- AlterEnum\n-- This migration adds more than one value to an enum.\n-- With PostgreSQL versions 11 and earlier, this is not possible\n-- in a single migration. This can be worked around by creating\n-- multiple migrations, each migration adding only one value to\n-- the enum.\n\n\nALTER TYPE \"VerificationCodeType\" ADD VALUE 'PASSKEY_REGISTRATION_CHALLENGE';\nALTER TYPE \"VerificationCodeType\" ADD VALUE 'PASSKEY_AUTHENTICATION_CHALLENGE';\n\n-- CreateTable\nCREATE TABLE \"PasskeyAuthMethodConfig\" (\n    \"projectConfigId\" UUID NOT NULL,\n    \"authMethodConfigId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"PasskeyAuthMethodConfig_pkey\" PRIMARY KEY (\"projectConfigId\",\"authMethodConfigId\")\n);\n\n-- CreateTable\nCREATE TABLE \"PasskeyAuthMethod\" (\n    \"projectId\" TEXT NOT NULL,\n    \"authMethodId\" UUID NOT NULL,\n    \"projectUserId\" UUID NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"credentialId\" TEXT NOT NULL,\n    \"publicKey\" TEXT NOT NULL,\n    \"userHandle\" TEXT NOT NULL,\n    \"transports\" TEXT[],\n    \"credentialDeviceType\" TEXT NOT NULL,\n    \"counter\" INTEGER NOT NULL,\n\n    CONSTRAINT \"PasskeyAuthMethod_pkey\" PRIMARY KEY (\"projectId\",\"authMethodId\")\n);\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"PasskeyAuthMethod_projectId_projectUserId_key\" ON \"PasskeyAuthMethod\"(\"projectId\", \"projectUserId\");\n\n-- AddForeignKey\nALTER TABLE \"PasskeyAuthMethodConfig\" ADD CONSTRAINT \"PasskeyAuthMethodConfig_projectConfigId_authMethodConfigId_fkey\" FOREIGN KEY (\"projectConfigId\", \"authMethodConfigId\") REFERENCES \"AuthMethodConfig\"(\"projectConfigId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasskeyAuthMethod\" ADD CONSTRAINT \"PasskeyAuthMethod_projectId_authMethodId_fkey\" FOREIGN KEY (\"projectId\", \"authMethodId\") REFERENCES \"AuthMethod\"(\"projectId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasskeyAuthMethod\" ADD CONSTRAINT \"PasskeyAuthMethod_projectId_projectUserId_fkey\" FOREIGN KEY (\"projectId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"projectId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20241026024655_user_sorting_indices",
    "sql": "-- CreateIndex\nCREATE INDEX \"ProjectUser_displayName_asc\" ON \"ProjectUser\"(\"projectId\", \"displayName\" ASC);\n\n-- CreateIndex\nCREATE INDEX \"ProjectUser_displayName_desc\" ON \"ProjectUser\"(\"projectId\", \"displayName\" DESC);\n\n-- CreateIndex\nCREATE INDEX \"ProjectUser_createdAt_asc\" ON \"ProjectUser\"(\"projectId\", \"createdAt\" ASC);\n\n-- CreateIndex\nCREATE INDEX \"ProjectUser_createdAt_desc\" ON \"ProjectUser\"(\"projectId\", \"createdAt\" DESC);\n"
  },
  {
    "name": "20241116221711_geolocation_events",
    "sql": "-- AlterTable\nALTER TABLE \"Event\" ADD COLUMN     \"endUserIpInfoGuessId\" UUID,\nADD COLUMN     \"isEndUserIpInfoGuessTrusted\" BOOLEAN NOT NULL DEFAULT false;\n\n-- CreateTable\nCREATE TABLE \"EventIpInfo\" (\n    \"id\" UUID NOT NULL,\n    \"ip\" TEXT NOT NULL,\n    \"countryCode\" TEXT,\n    \"regionCode\" TEXT,\n    \"cityName\" TEXT,\n    \"latitude\" DOUBLE PRECISION,\n    \"longitude\" DOUBLE PRECISION,\n    \"tzIdentifier\" TEXT,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"EventIpInfo_pkey\" PRIMARY KEY (\"id\")\n);\n\n-- AddForeignKey\nALTER TABLE \"Event\" ADD CONSTRAINT \"Event_endUserIpInfoGuessId_fkey\" FOREIGN KEY (\"endUserIpInfoGuessId\") REFERENCES \"EventIpInfo\"(\"id\") ON DELETE SET NULL ON UPDATE CASCADE;\n"
  },
  {
    "name": "20241124163535_verification_code_handler_index",
    "sql": "-- CreateIndex\nCREATE INDEX \"VerificationCode_data_idx\" ON \"VerificationCode\" USING GIN (\"data\" jsonb_path_ops);\n"
  },
  {
    "name": "20241201043500_idp",
    "sql": "-- CreateTable\nCREATE TABLE \"IdPAccountToCdfcResultMapping\" (\n    \"idpId\" TEXT NOT NULL,\n    \"id\" TEXT NOT NULL,\n    \"idpAccountId\" UUID NOT NULL,\n    \"cdfcResult\" JSONB NOT NULL,\n\n    CONSTRAINT \"IdPAccountToCdfcResultMapping_pkey\" PRIMARY KEY (\"idpId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"ProjectWrapperCodes\" (\n    \"idpId\" TEXT NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"interactionUid\" TEXT NOT NULL,\n    \"authorizationCode\" TEXT NOT NULL,\n    \"cdfcResult\" JSONB NOT NULL,\n\n    CONSTRAINT \"ProjectWrapperCodes_pkey\" PRIMARY KEY (\"idpId\",\"id\")\n);\n\n-- CreateTable\nCREATE TABLE \"IdPAdapterData\" (\n    \"idpId\" TEXT NOT NULL,\n    \"model\" TEXT NOT NULL,\n    \"id\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"payload\" JSONB NOT NULL,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"IdPAdapterData_pkey\" PRIMARY KEY (\"idpId\",\"model\",\"id\")\n);\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"IdPAccountToCdfcResultMapping_idpAccountId_key\" ON \"IdPAccountToCdfcResultMapping\"(\"idpAccountId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProjectWrapperCodes_authorizationCode_key\" ON \"ProjectWrapperCodes\"(\"authorizationCode\");\n\n-- CreateIndex\nCREATE INDEX \"IdPAdapterData_payload_idx\" ON \"IdPAdapterData\" USING GIN (\"payload\" jsonb_path_ops);\n\n-- CreateIndex\nCREATE INDEX \"IdPAdapterData_expiresAt_idx\" ON \"IdPAdapterData\"(\"expiresAt\");\n"
  },
  {
    "name": "20241207223510_neon_project_transfers",
    "sql": "-- AlterEnum\nALTER TYPE \"VerificationCodeType\" ADD VALUE 'NEON_INTEGRATION_PROJECT_TRANSFER';\n\n-- CreateTable\nCREATE TABLE \"NeonProvisionedProject\" (\n    \"projectId\" TEXT NOT NULL,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"neonClientId\" TEXT NOT NULL,\n\n    CONSTRAINT \"NeonProvisionedProject_pkey\" PRIMARY KEY (\"projectId\")\n);\n\n-- AddForeignKey\nALTER TABLE \"NeonProvisionedProject\" ADD CONSTRAINT \"NeonProvisionedProject_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20241220033652_event_indices",
    "sql": "CREATE INDEX idx_event_userid ON \"Event\" ((data->>'userId'));\nCREATE INDEX idx_event_projectid ON \"Event\" ((data->>'projectId'));"
  },
  {
    "name": "20241223205737_remove_empty_profile_images",
    "sql": "-- Some older versions allowed the empty string as a profile image.\n-- We fix that.\n\nUPDATE \"ProjectUser\" SET \"profileImageUrl\" = NULL WHERE \"profileImageUrl\" = '';\n"
  },
  {
    "name": "20241223225110_fill_empty_project_config_values",
    "sql": "-- Some older versions allowed the empty string for OAuth provider clientId and clientSecret values.\n-- We fix that.\n\nUPDATE \"StandardOAuthProviderConfig\" SET \"clientId\" = 'invalid' WHERE \"clientId\" = '';\nUPDATE \"StandardOAuthProviderConfig\" SET \"clientSecret\" = 'invalid' WHERE \"clientSecret\" = '';\n"
  },
  {
    "name": "20241223231022_remove_empty_team_profile_images",
    "sql": "-- Some older versions allowed the empty string as a team profile image.\n-- We fix that.\n\nUPDATE \"Team\" SET \"profileImageUrl\" = NULL WHERE \"profileImageUrl\" = '';\n"
  },
  {
    "name": "20241223231023_onlyhttps_domains",
    "sql": "-- Some older versions allowed http:// URLs as trusted domains, instead of just https://.\n-- We fix that.\n\nUPDATE \"ProjectDomain\" SET \"domain\" = 'https://example.com' WHERE \"domain\" LIKE 'http://%';\n"
  },
  {
    "name": "20241228033652_more_event_indices",
    "sql": "-- It's very common to query by userId, projectId, and eventStartedAt at the same time.\n-- We can use a composite index to speed up the query.\n-- Sadly we can't add this to the Prisma schema itself because Prisma does not understand composite indexes of JSONB fields.\n-- So we have to add it manually.\nCREATE INDEX idx_event_userid_projectid_eventstartedat ON \"Event\" ((data->>'projectId'), (data->>'userId'), \"eventStartedAt\");\n"
  },
  {
    "name": "20250206063807_tenancies",
    "sql": "-- DropForeignKey\nALTER TABLE \"AuthMethod\" DROP CONSTRAINT \"AuthMethod_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"AuthMethod\" DROP CONSTRAINT \"AuthMethod_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ConnectedAccount\" DROP CONSTRAINT \"ConnectedAccount_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ConnectedAccount\" DROP CONSTRAINT \"ConnectedAccount_projectId_oauthProviderConfigId_providerA_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ConnectedAccount\" DROP CONSTRAINT \"ConnectedAccount_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ContactChannel\" DROP CONSTRAINT \"ContactChannel_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ContactChannel\" DROP CONSTRAINT \"ContactChannel_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"OAuthAccessToken\" DROP CONSTRAINT \"OAuthAccessToken_projectId_oAuthProviderConfigId_providerA_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"OAuthAuthMethod\" DROP CONSTRAINT \"OAuthAuthMethod_projectId_authMethodId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"OAuthAuthMethod\" DROP CONSTRAINT \"OAuthAuthMethod_projectId_oauthProviderConfigId_providerAc_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"OAuthAuthMethod\" DROP CONSTRAINT \"OAuthAuthMethod_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"OAuthToken\" DROP CONSTRAINT \"OAuthToken_projectId_oAuthProviderConfigId_providerAccount_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"OtpAuthMethod\" DROP CONSTRAINT \"OtpAuthMethod_projectId_authMethodId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"OtpAuthMethod\" DROP CONSTRAINT \"OtpAuthMethod_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"PasskeyAuthMethod\" DROP CONSTRAINT \"PasskeyAuthMethod_projectId_authMethodId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"PasskeyAuthMethod\" DROP CONSTRAINT \"PasskeyAuthMethod_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"PasswordAuthMethod\" DROP CONSTRAINT \"PasswordAuthMethod_projectId_authMethodId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"PasswordAuthMethod\" DROP CONSTRAINT \"PasswordAuthMethod_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"Permission\" DROP CONSTRAINT \"Permission_projectId_teamId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectConfigOverride\" DROP CONSTRAINT \"ProjectConfigOverride_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUser\" DROP CONSTRAINT \"ProjectUser_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserAuthorizationCode\" DROP CONSTRAINT \"ProjectUserAuthorizationCode_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" DROP CONSTRAINT \"ProjectUserOAuthAccount_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"ProjectUserRefreshToken\" DROP CONSTRAINT \"ProjectUserRefreshToken_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"Team\" DROP CONSTRAINT \"Team_projectId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"TeamMember\" DROP CONSTRAINT \"TeamMember_projectId_projectUserId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"TeamMember\" DROP CONSTRAINT \"TeamMember_projectId_teamId_fkey\";\n\n-- DropForeignKey\nALTER TABLE \"TeamMemberDirectPermission\" DROP CONSTRAINT \"TeamMemberDirectPermission_projectId_projectUserId_teamId_fkey\";\n\n-- DropIndex\nDROP INDEX \"ConnectedAccount_projectId_oauthProviderConfigId_providerAc_key\";\n\n-- DropIndex\nDROP INDEX \"ContactChannel_projectId_projectUserId_type_isPrimary_key\";\n\n-- DropIndex\nDROP INDEX \"ContactChannel_projectId_projectUserId_type_value_key\";\n\n-- DropIndex\nDROP INDEX \"ContactChannel_projectId_type_value_usedForAuth_key\";\n\n-- DropIndex\nDROP INDEX \"OAuthAuthMethod_projectId_oauthProviderConfigId_providerAcc_key\";\n\n-- DropIndex\nDROP INDEX \"OtpAuthMethod_projectId_projectUserId_key\";\n\n-- DropIndex\nDROP INDEX \"PasskeyAuthMethod_projectId_projectUserId_key\";\n\n-- DropIndex\nDROP INDEX \"PasswordAuthMethod_projectId_projectUserId_key\";\n\n-- DropIndex\nDROP INDEX \"Permission_projectId_teamId_queryableId_key\";\n\n-- DropIndex\nDROP INDEX \"ProjectUser_createdAt_asc\";\n\n-- DropIndex\nDROP INDEX \"ProjectUser_createdAt_desc\";\n\n-- DropIndex\nDROP INDEX \"ProjectUser_displayName_asc\";\n\n-- DropIndex\nDROP INDEX \"ProjectUser_displayName_desc\";\n\n-- DropIndex\nDROP INDEX \"TeamMember_projectId_projectUserId_isSelected_key\";\n\n-- DropIndex\nDROP INDEX \"TeamMemberDirectPermission_projectId_projectUserId_teamId_p_key\";\n\n-- DropIndex\nDROP INDEX \"TeamMemberDirectPermission_projectId_projectUserId_teamId_s_key\";\n\n-- Create a Tenancy table\nCREATE TABLE \"Tenancy\" (\n  \"id\" UUID NOT NULL,\n  \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  \"updatedAt\" TIMESTAMP(3) NOT NULL,\n  \"projectId\" TEXT NOT NULL,\n  \"branchId\" TEXT NOT NULL,\n  \"organizationId\" UUID,\n  \"hasNoOrganization\" \"BooleanTrue\",\n\n  CONSTRAINT \"Tenancy_pkey\" PRIMARY KEY (\"id\")\n);\n\n-- Create a Tenancy for each Project (using branch 'main' and no organization)\nINSERT INTO \"Tenancy\" (id, \"createdAt\", \"updatedAt\", \"projectId\", \"branchId\", \"organizationId\", \"hasNoOrganization\")\nSELECT gen_random_uuid(), now(), now(), id, 'main', NULL, 'TRUE'\nFROM \"Project\";\n\n/* ===== Update AuthMethod table ===== */\nALTER TABLE \"AuthMethod\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"AuthMethod\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"AuthMethod\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"AuthMethod\" DROP CONSTRAINT \"AuthMethod_pkey\";\nALTER TABLE \"AuthMethod\" DROP COLUMN \"projectId\";\nALTER TABLE \"AuthMethod\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"AuthMethod\" ADD CONSTRAINT \"AuthMethod_pkey\" PRIMARY KEY (\"tenancyId\", \"id\");\n\n/* ===== Update ConnectedAccount table ===== */\nALTER TABLE \"ConnectedAccount\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"ConnectedAccount\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"ConnectedAccount\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"ConnectedAccount\" DROP CONSTRAINT \"ConnectedAccount_pkey\";\nALTER TABLE \"ConnectedAccount\" DROP COLUMN \"projectId\";\nALTER TABLE \"ConnectedAccount\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_pkey\" PRIMARY KEY (\"tenancyId\", \"id\");\n\n/* ===== Update ContactChannel table ===== */\nALTER TABLE \"ContactChannel\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"ContactChannel\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"ContactChannel\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"ContactChannel\" DROP CONSTRAINT \"ContactChannel_pkey\";\nALTER TABLE \"ContactChannel\" DROP COLUMN \"projectId\";\nALTER TABLE \"ContactChannel\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"ContactChannel\" ADD CONSTRAINT \"ContactChannel_pkey\" PRIMARY KEY (\"tenancyId\", \"projectUserId\", \"id\");\n\n/* ===== Update OAuthAccessToken table ===== */\nALTER TABLE \"OAuthAccessToken\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"OAuthAccessToken\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"OAuthAccessToken\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"OAuthAccessToken\" DROP COLUMN \"projectId\";\nALTER TABLE \"OAuthAccessToken\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\n\n/* ===== Update OAuthAuthMethod table ===== */\nALTER TABLE \"OAuthAuthMethod\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"OAuthAuthMethod\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"OAuthAuthMethod\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"OAuthAuthMethod\" DROP CONSTRAINT \"OAuthAuthMethod_pkey\";\nALTER TABLE \"OAuthAuthMethod\" DROP COLUMN \"projectId\";\nALTER TABLE \"OAuthAuthMethod\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"OAuthAuthMethod\" ADD CONSTRAINT \"OAuthAuthMethod_pkey\" PRIMARY KEY (\"tenancyId\", \"authMethodId\");\n\n/* ===== Update OAuthToken table ===== */\nALTER TABLE \"OAuthToken\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"OAuthToken\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"OAuthToken\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"OAuthToken\" DROP COLUMN \"projectId\";\nALTER TABLE \"OAuthToken\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\n\n/* ===== Update OtpAuthMethod table ===== */\nALTER TABLE \"OtpAuthMethod\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"OtpAuthMethod\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"OtpAuthMethod\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"OtpAuthMethod\" DROP CONSTRAINT \"OtpAuthMethod_pkey\";\nALTER TABLE \"OtpAuthMethod\" DROP COLUMN \"projectId\";\nALTER TABLE \"OtpAuthMethod\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"OtpAuthMethod\" ADD CONSTRAINT \"OtpAuthMethod_pkey\" PRIMARY KEY (\"tenancyId\", \"authMethodId\");\n\n/* ===== Update PasskeyAuthMethod table ===== */\nALTER TABLE \"PasskeyAuthMethod\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"PasskeyAuthMethod\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"PasskeyAuthMethod\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"PasskeyAuthMethod\" DROP CONSTRAINT \"PasskeyAuthMethod_pkey\";\nALTER TABLE \"PasskeyAuthMethod\" DROP COLUMN \"projectId\";\nALTER TABLE \"PasskeyAuthMethod\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"PasskeyAuthMethod\" ADD CONSTRAINT \"PasskeyAuthMethod_pkey\" PRIMARY KEY (\"tenancyId\", \"authMethodId\");\n\n/* ===== Update PasswordAuthMethod table ===== */\nALTER TABLE \"PasswordAuthMethod\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"PasswordAuthMethod\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"PasswordAuthMethod\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"PasswordAuthMethod\" DROP CONSTRAINT \"PasswordAuthMethod_pkey\";\nALTER TABLE \"PasswordAuthMethod\" DROP COLUMN \"projectId\";\nALTER TABLE \"PasswordAuthMethod\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"PasswordAuthMethod\" ADD CONSTRAINT \"PasswordAuthMethod_pkey\" PRIMARY KEY (\"tenancyId\", \"authMethodId\");\n\n/* ===== Update Permission table ===== */\nALTER TABLE \"Permission\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"Permission\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"Permission\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"Permission\" DROP COLUMN \"projectId\";\nALTER TABLE \"Permission\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\n\n/* ===== Update ProjectUser table ===== */\nALTER TABLE \"ProjectUser\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"ProjectUser\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"ProjectUser\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"ProjectUser\" DROP CONSTRAINT \"ProjectUser_pkey\";\nALTER TABLE \"ProjectUser\" DROP COLUMN \"projectId\";\nALTER TABLE \"ProjectUser\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"ProjectUser\" ADD CONSTRAINT \"ProjectUser_pkey\" PRIMARY KEY (\"tenancyId\", \"projectUserId\");\n\n/* ===== Update ProjectUserAuthorizationCode table ===== */\nALTER TABLE \"ProjectUserAuthorizationCode\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"ProjectUserAuthorizationCode\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"ProjectUserAuthorizationCode\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"ProjectUserAuthorizationCode\" DROP CONSTRAINT \"ProjectUserAuthorizationCode_pkey\";\nALTER TABLE \"ProjectUserAuthorizationCode\" DROP COLUMN \"projectId\";\nALTER TABLE \"ProjectUserAuthorizationCode\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"ProjectUserAuthorizationCode\" ADD CONSTRAINT \"ProjectUserAuthorizationCode_pkey\" PRIMARY KEY (\"tenancyId\", \"authorizationCode\");\n\n/* ===== Update ProjectUserOAuthAccount table ===== */\nALTER TABLE \"ProjectUserOAuthAccount\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"ProjectUserOAuthAccount\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"ProjectUserOAuthAccount\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"ProjectUserOAuthAccount\" DROP CONSTRAINT \"ProjectUserOAuthAccount_pkey\";\nALTER TABLE \"ProjectUserOAuthAccount\" DROP COLUMN \"projectId\";\nALTER TABLE \"ProjectUserOAuthAccount\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"ProjectUserOAuthAccount\" ADD CONSTRAINT \"ProjectUserOAuthAccount_pkey\" PRIMARY KEY (\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\");\n\n/* ===== Update ProjectUserRefreshToken table ===== */\nALTER TABLE \"ProjectUserRefreshToken\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"ProjectUserRefreshToken\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"ProjectUserRefreshToken\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"ProjectUserRefreshToken\" DROP CONSTRAINT \"ProjectUserRefreshToken_pkey\";\nALTER TABLE \"ProjectUserRefreshToken\" DROP COLUMN \"projectId\";\nALTER TABLE \"ProjectUserRefreshToken\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"ProjectUserRefreshToken\" ADD CONSTRAINT \"ProjectUserRefreshToken_pkey\" PRIMARY KEY (\"tenancyId\", \"refreshToken\");\n\n/* ===== Update Team table ===== */\nALTER TABLE \"Team\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"Team\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"Team\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"Team\" DROP CONSTRAINT \"Team_pkey\";\nALTER TABLE \"Team\" DROP COLUMN \"projectId\";\nALTER TABLE \"Team\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"Team\" ADD CONSTRAINT \"Team_pkey\" PRIMARY KEY (\"tenancyId\", \"teamId\");\n\n/* ===== Update TeamMember table ===== */\nALTER TABLE \"TeamMember\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"TeamMember\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"TeamMember\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"TeamMember\" DROP CONSTRAINT \"TeamMember_pkey\";\nALTER TABLE \"TeamMember\" DROP COLUMN \"projectId\";\nALTER TABLE \"TeamMember\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\nALTER TABLE \"TeamMember\" ADD CONSTRAINT \"TeamMember_pkey\" PRIMARY KEY (\"tenancyId\", \"projectUserId\", \"teamId\");\n\n/* ===== Update TeamMemberDirectPermission table ===== */\nALTER TABLE \"TeamMemberDirectPermission\" ADD COLUMN \"tenancyId_temp\" UUID;\nUPDATE \"TeamMemberDirectPermission\"\nSET \"tenancyId_temp\" = t.id\nFROM \"Tenancy\" t\nWHERE t.\"projectId\" = \"TeamMemberDirectPermission\".\"projectId\" AND t.\"branchId\" = 'main' AND t.\"organizationId\" IS NULL;\nALTER TABLE \"TeamMemberDirectPermission\" DROP COLUMN \"projectId\";\nALTER TABLE \"TeamMemberDirectPermission\" RENAME COLUMN \"tenancyId_temp\" TO \"tenancyId\";\n\n-- DropTable\nDROP TABLE \"ProjectConfigOverride\";\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"Tenancy_projectId_branchId_organizationId_key\" ON \"Tenancy\"(\"projectId\", \"branchId\", \"organizationId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"Tenancy_projectId_branchId_hasNoOrganization_key\" ON \"Tenancy\"(\"projectId\", \"branchId\", \"hasNoOrganization\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ConnectedAccount_tenancyId_oauthProviderConfigId_providerAc_key\" ON \"ConnectedAccount\"(\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ContactChannel_tenancyId_projectUserId_type_isPrimary_key\" ON \"ContactChannel\"(\"tenancyId\", \"projectUserId\", \"type\", \"isPrimary\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ContactChannel_tenancyId_projectUserId_type_value_key\" ON \"ContactChannel\"(\"tenancyId\", \"projectUserId\", \"type\", \"value\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ContactChannel_tenancyId_type_value_usedForAuth_key\" ON \"ContactChannel\"(\"tenancyId\", \"type\", \"value\", \"usedForAuth\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"OAuthAuthMethod_tenancyId_oauthProviderConfigId_providerAcc_key\" ON \"OAuthAuthMethod\"(\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"OtpAuthMethod_tenancyId_projectUserId_key\" ON \"OtpAuthMethod\"(\"tenancyId\", \"projectUserId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"PasskeyAuthMethod_tenancyId_projectUserId_key\" ON \"PasskeyAuthMethod\"(\"tenancyId\", \"projectUserId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"PasswordAuthMethod_tenancyId_projectUserId_key\" ON \"PasswordAuthMethod\"(\"tenancyId\", \"projectUserId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"Permission_tenancyId_teamId_queryableId_key\" ON \"Permission\"(\"tenancyId\", \"teamId\", \"queryableId\");\n\n-- CreateIndex\nCREATE INDEX \"ProjectUser_displayName_asc\" ON \"ProjectUser\"(\"tenancyId\", \"displayName\" ASC);\n\n-- CreateIndex\nCREATE INDEX \"ProjectUser_displayName_desc\" ON \"ProjectUser\"(\"tenancyId\", \"displayName\" DESC);\n\n-- CreateIndex\nCREATE INDEX \"ProjectUser_createdAt_asc\" ON \"ProjectUser\"(\"tenancyId\", \"createdAt\" ASC);\n\n-- CreateIndex\nCREATE INDEX \"ProjectUser_createdAt_desc\" ON \"ProjectUser\"(\"tenancyId\", \"createdAt\" DESC);\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"TeamMember_tenancyId_projectUserId_isSelected_key\" ON \"TeamMember\"(\"tenancyId\", \"projectUserId\", \"isSelected\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"TeamMemberDirectPermission_tenancyId_projectUserId_teamId_p_key\" ON \"TeamMemberDirectPermission\"(\"tenancyId\", \"projectUserId\", \"teamId\", \"permissionDbId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"TeamMemberDirectPermission_tenancyId_projectUserId_teamId_s_key\" ON \"TeamMemberDirectPermission\"(\"tenancyId\", \"projectUserId\", \"teamId\", \"systemPermission\");\n\n-- AddForeignKey\nALTER TABLE \"Tenancy\" ADD CONSTRAINT \"Tenancy_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"Team\" ADD CONSTRAINT \"Team_tenancyId_fkey\" FOREIGN KEY (\"tenancyId\") REFERENCES \"Tenancy\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"TeamMember\" ADD CONSTRAINT \"TeamMember_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"TeamMember\" ADD CONSTRAINT \"TeamMember_tenancyId_teamId_fkey\" FOREIGN KEY (\"tenancyId\", \"teamId\") REFERENCES \"Team\"(\"tenancyId\", \"teamId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"TeamMemberDirectPermission\" ADD CONSTRAINT \"TeamMemberDirectPermission_tenancyId_projectUserId_teamId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\", \"teamId\") REFERENCES \"TeamMember\"(\"tenancyId\", \"projectUserId\", \"teamId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"Permission\" ADD CONSTRAINT \"Permission_tenancyId_teamId_fkey\" FOREIGN KEY (\"tenancyId\", \"teamId\") REFERENCES \"Team\"(\"tenancyId\", \"teamId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUser\" ADD CONSTRAINT \"ProjectUser_tenancyId_fkey\" FOREIGN KEY (\"tenancyId\") REFERENCES \"Tenancy\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserOAuthAccount\" ADD CONSTRAINT \"ProjectUserOAuthAccount_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ContactChannel\" ADD CONSTRAINT \"ContactChannel_tenancyId_fkey\" FOREIGN KEY (\"tenancyId\") REFERENCES \"Tenancy\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ContactChannel\" ADD CONSTRAINT \"ContactChannel_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_tenancyId_oauthProviderConfigId_providerA_fkey\" FOREIGN KEY (\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_tenancyId_fkey\" FOREIGN KEY (\"tenancyId\") REFERENCES \"Tenancy\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ConnectedAccount\" ADD CONSTRAINT \"ConnectedAccount_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"AuthMethod\" ADD CONSTRAINT \"AuthMethod_tenancyId_fkey\" FOREIGN KEY (\"tenancyId\") REFERENCES \"Tenancy\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"AuthMethod\" ADD CONSTRAINT \"AuthMethod_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OtpAuthMethod\" ADD CONSTRAINT \"OtpAuthMethod_tenancyId_authMethodId_fkey\" FOREIGN KEY (\"tenancyId\", \"authMethodId\") REFERENCES \"AuthMethod\"(\"tenancyId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OtpAuthMethod\" ADD CONSTRAINT \"OtpAuthMethod_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasswordAuthMethod\" ADD CONSTRAINT \"PasswordAuthMethod_tenancyId_authMethodId_fkey\" FOREIGN KEY (\"tenancyId\", \"authMethodId\") REFERENCES \"AuthMethod\"(\"tenancyId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasswordAuthMethod\" ADD CONSTRAINT \"PasswordAuthMethod_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasskeyAuthMethod\" ADD CONSTRAINT \"PasskeyAuthMethod_tenancyId_authMethodId_fkey\" FOREIGN KEY (\"tenancyId\", \"authMethodId\") REFERENCES \"AuthMethod\"(\"tenancyId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"PasskeyAuthMethod\" ADD CONSTRAINT \"PasskeyAuthMethod_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthAuthMethod\" ADD CONSTRAINT \"OAuthAuthMethod_tenancyId_authMethodId_fkey\" FOREIGN KEY (\"tenancyId\", \"authMethodId\") REFERENCES \"AuthMethod\"(\"tenancyId\", \"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthAuthMethod\" ADD CONSTRAINT \"OAuthAuthMethod_tenancyId_oauthProviderConfigId_providerAc_fkey\" FOREIGN KEY (\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthAuthMethod\" ADD CONSTRAINT \"OAuthAuthMethod_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthToken\" ADD CONSTRAINT \"OAuthToken_tenancyId_oAuthProviderConfigId_providerAccount_fkey\" FOREIGN KEY (\"tenancyId\", \"oAuthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"OAuthAccessToken\" ADD CONSTRAINT \"OAuthAccessToken_tenancyId_oAuthProviderConfigId_providerA_fkey\" FOREIGN KEY (\"tenancyId\", \"oAuthProviderConfigId\", \"providerAccountId\") REFERENCES \"ProjectUserOAuthAccount\"(\"tenancyId\", \"oauthProviderConfigId\", \"providerAccountId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserRefreshToken\" ADD CONSTRAINT \"ProjectUserRefreshToken_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"ProjectUserAuthorizationCode\" ADD CONSTRAINT \"ProjectUserAuthorizationCode_tenancyId_projectUserId_fkey\" FOREIGN KEY (\"tenancyId\", \"projectUserId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20250206073652_branch_event_indices",
    "sql": "-- It's very common to query by userId, projectId, branchId, and eventStartedAt at the same time.\n-- We can use a composite index to speed up the query.\n-- Sadly we can't add this to the Prisma schema itself because Prisma does not understand composite indexes of JSONB fields.\n-- So we have to add it manually.\nCREATE INDEX idx_event_userid_projectid_branchid_eventstartedat ON \"Event\" ((data->>'projectId'), (data->>'branchId'), (data->>'userId'), \"eventStartedAt\");\n"
  },
  {
    "name": "20250207071519_tenancies_finalization",
    "sql": "/*\n  Warnings:\n\n  x The primary key for the `VerificationCode` table will be changed. If it partially fails, the table could be left without primary key constraint.\n  x A unique constraint covering the columns `[mirroredProjectId,mirroredBranchId,projectUserId]` on the table `ProjectUser` will be added. If there are existing duplicate values, this will fail.\n  x A unique constraint covering the columns `[mirroredProjectId,mirroredBranchId,teamId]` on the table `Team` will be added. If there are existing duplicate values, this will fail.\n  x A unique constraint covering the columns `[projectId,branchId,code]` on the table `VerificationCode` will be added. If there are existing duplicate values, this will fail.\n  x Made the column `tenancyId` on table `OAuthAccessToken` required. This step will fail if there are existing NULL values in that column.\n  x Made the column `tenancyId` on table `OAuthToken` required. This step will fail if there are existing NULL values in that column.\n  - Added the required column `mirroredBranchId` to the `ProjectUser` table without a default value. This is not possible if the table is not empty.\n  - Added the required column `mirroredProjectId` to the `ProjectUser` table without a default value. This is not possible if the table is not empty.\n  - Added the required column `mirroredBranchId` to the `Team` table without a default value. This is not possible if the table is not empty.\n  - Added the required column `mirroredProjectId` to the `Team` table without a default value. This is not possible if the table is not empty.\n  x Made the column `tenancyId` on table `TeamMemberDirectPermission` required. This step will fail if there are existing NULL values in that column.\n  - Added the required column `branchId` to the `VerificationCode` table without a default value. This is not possible if the table is not empty.\n*/\n\n-- DropIndex\nDROP INDEX \"VerificationCode_projectId_code_key\";\n\n-- AlterTable\nALTER TABLE \"OAuthAccessToken\" ALTER COLUMN \"tenancyId\" SET NOT NULL;\n\n-- AlterTable\nALTER TABLE \"OAuthToken\" ALTER COLUMN \"tenancyId\" SET NOT NULL;\n\n-- AlterTable for ProjectUser: add columns without NOT NULL\nALTER TABLE \"ProjectUser\" \n  ADD COLUMN \"mirroredBranchId\" TEXT,\n  ADD COLUMN \"mirroredProjectId\" TEXT;\n\n-- Update ProjectUser: set new columns using values from associated Tenancy\nUPDATE \"ProjectUser\"\nSET \"mirroredBranchId\" = tenancy.\"branchId\",\n    \"mirroredProjectId\" = tenancy.\"projectId\"\nFROM \"Tenancy\" AS tenancy\nWHERE \"ProjectUser\".\"tenancyId\" = tenancy.\"id\";\n\n-- Set NOT NULL constraints on ProjectUser new columns\nALTER TABLE \"ProjectUser\" \n  ALTER COLUMN \"mirroredBranchId\" SET NOT NULL,\n  ALTER COLUMN \"mirroredProjectId\" SET NOT NULL;\n\n-- AlterTable for Team: add columns without NOT NULL\nALTER TABLE \"Team\" \n  ADD COLUMN \"mirroredBranchId\" TEXT,\n  ADD COLUMN \"mirroredProjectId\" TEXT;\n\n-- Update Team: set new columns using values from associated Tenancy\nUPDATE \"Team\"\nSET \"mirroredBranchId\" = tenancy.\"branchId\",\n    \"mirroredProjectId\" = tenancy.\"projectId\"\nFROM \"Tenancy\" AS tenancy\nWHERE \"Team\".\"tenancyId\" = tenancy.\"id\";\n\n-- Set NOT NULL constraints on Team new columns\nALTER TABLE \"Team\" \n  ALTER COLUMN \"mirroredBranchId\" SET NOT NULL,\n  ALTER COLUMN \"mirroredProjectId\" SET NOT NULL;\n\n-- Alter Table for TeamMemberDirectPermission\nALTER TABLE \"TeamMemberDirectPermission\" ALTER COLUMN \"tenancyId\" SET NOT NULL;\n\n-- For VerificationCode: update branchId handling\nALTER TABLE \"VerificationCode\" DROP CONSTRAINT \"VerificationCode_pkey\";\n\n-- Add the branchId column without NOT NULL\nALTER TABLE \"VerificationCode\" ADD COLUMN \"branchId\" TEXT;\n\n-- Set branchId to 'main' for all existing rows\nUPDATE \"VerificationCode\" SET \"branchId\" = 'main' WHERE \"branchId\" IS NULL;\n\n-- Set NOT NULL constraint on branchId\nALTER TABLE \"VerificationCode\" ALTER COLUMN \"branchId\" SET NOT NULL;\n\n-- Recreate primary key with new branchId\nALTER TABLE \"VerificationCode\" ADD CONSTRAINT \"VerificationCode_pkey\" PRIMARY KEY (\"projectId\", \"branchId\", \"id\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"ProjectUser_mirroredProjectId_mirroredBranchId_projectUserI_key\" ON \"ProjectUser\"(\"mirroredProjectId\", \"mirroredBranchId\", \"projectUserId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"Team_mirroredProjectId_mirroredBranchId_teamId_key\" ON \"Team\"(\"mirroredProjectId\", \"mirroredBranchId\", \"teamId\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"VerificationCode_projectId_branchId_code_key\" ON \"VerificationCode\"(\"projectId\", \"branchId\", \"code\");\n\n-- AddForeignKey\nALTER TABLE \"ProjectUser\" ADD CONSTRAINT \"ProjectUser_mirroredProjectId_fkey\" FOREIGN KEY (\"mirroredProjectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n\n-- Delete VerificationCodes with non-existing projectId\nDELETE FROM \"VerificationCode\" WHERE \"projectId\" NOT IN (SELECT \"id\" FROM \"Project\");\n\n-- AddForeignKey\nALTER TABLE \"VerificationCode\" ADD CONSTRAINT \"VerificationCode_projectId_fkey\" FOREIGN KEY (\"projectId\") REFERENCES \"Project\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20250214175437_create_user_indices",
    "sql": "-- CreateIndex\nCREATE INDEX \"AuthMethod_tenancyId_projectUserId_idx\" ON \"AuthMethod\"(\"tenancyId\", \"projectUserId\");\n\n-- CreateIndex\nCREATE INDEX \"PermissionEdge_parentPermissionDbId_idx\" ON \"PermissionEdge\"(\"parentPermissionDbId\");\n\n-- CreateIndex\nCREATE INDEX \"PermissionEdge_childPermissionDbId_idx\" ON \"PermissionEdge\"(\"childPermissionDbId\");\n\n-- CreateIndex\nCREATE INDEX \"ProjectUserOAuthAccount_tenancyId_projectUserId_idx\" ON \"ProjectUserOAuthAccount\"(\"tenancyId\", \"projectUserId\");\n"
  },
  {
    "name": "20250221013242_sent_email_table",
    "sql": "-- CreateTable\nCREATE TABLE \"SentEmail\" (\n    \"tenancyId\" UUID NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"userId\" UUID,\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n    \"senderConfig\" JSONB NOT NULL,\n    \"to\" TEXT[],\n    \"subject\" TEXT NOT NULL,\n    \"html\" TEXT,\n    \"text\" TEXT,\n    \"error\" JSONB,\n\n    CONSTRAINT \"SentEmail_pkey\" PRIMARY KEY (\"tenancyId\",\"id\")\n);\n\n-- AddForeignKey\nALTER TABLE \"SentEmail\" ADD CONSTRAINT \"SentEmail_tenancyId_fkey\" FOREIGN KEY (\"tenancyId\") REFERENCES \"Tenancy\"(\"id\") ON DELETE RESTRICT ON UPDATE CASCADE;\n\n-- AddForeignKey\nALTER TABLE \"SentEmail\" ADD CONSTRAINT \"SentEmail_tenancyId_userId_fkey\" FOREIGN KEY (\"tenancyId\", \"userId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE RESTRICT ON UPDATE CASCADE;\n"
  },
  {
    "name": "20250225200753_add_tenancy_cascade",
    "sql": "-- DropForeignKey\nALTER TABLE \"SentEmail\" DROP CONSTRAINT \"SentEmail_tenancyId_fkey\";\n\n-- AddForeignKey\nALTER TABLE \"SentEmail\" ADD CONSTRAINT \"SentEmail_tenancyId_fkey\" FOREIGN KEY (\"tenancyId\") REFERENCES \"Tenancy\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20250225200857_add_another",
    "sql": "-- DropForeignKey\nALTER TABLE \"SentEmail\" DROP CONSTRAINT \"SentEmail_tenancyId_userId_fkey\";\n\n-- AddForeignKey\nALTER TABLE \"SentEmail\" ADD CONSTRAINT \"SentEmail_tenancyId_userId_fkey\" FOREIGN KEY (\"tenancyId\", \"userId\") REFERENCES \"ProjectUser\"(\"tenancyId\", \"projectUserId\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20250227004548_make_project_description_non_nullable",
    "sql": "/*\n  Warnings:\n\n  - Made the column `description` on table `Project` required. This step will fail if there are existing NULL values in that column.\n\n*/\n-- First, update any null descriptions to empty string\nUPDATE \"Project\" SET \"description\" = '' WHERE \"description\" IS NULL;\n\n-- AlterTable\nALTER TABLE \"Project\" ALTER COLUMN \"description\" SET NOT NULL;\n"
  },
  {
    "name": "20250303231152_add_cli_auth",
    "sql": "-- CreateTable\nCREATE TABLE \"CliAuthAttempt\" (\n    \"tenancyId\" UUID NOT NULL,\n    \"id\" UUID NOT NULL,\n    \"pollingCode\" TEXT NOT NULL,\n    \"loginCode\" TEXT NOT NULL,\n    \"refreshToken\" TEXT,\n    \"expiresAt\" TIMESTAMP(3) NOT NULL,\n    \"usedAt\" TIMESTAMP(3),\n    \"createdAt\" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    \"updatedAt\" TIMESTAMP(3) NOT NULL,\n\n    CONSTRAINT \"CliAuthAttempt_pkey\" PRIMARY KEY (\"tenancyId\",\"id\")\n);\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"CliAuthAttempt_pollingCode_key\" ON \"CliAuthAttempt\"(\"pollingCode\");\n\n-- CreateIndex\nCREATE UNIQUE INDEX \"CliAuthAttempt_loginCode_key\" ON \"CliAuthAttempt\"(\"loginCode\");\n\n-- AddForeignKey\nALTER TABLE \"CliAuthAttempt\" ADD CONSTRAINT \"CliAuthAttempt_tenancyId_fkey\" FOREIGN KEY (\"tenancyId\") REFERENCES \"Tenancy\"(\"id\") ON DELETE CASCADE ON UPDATE CASCADE;\n"
  },
  {
    "name": "20250304004231_merge_oauth_methods",
    "sql": "-- CreateEnum\nCREATE TYPE \"OAuthAccountMergeStrategy\" AS ENUM ('LINK_METHOD', 'RAISE_ERROR', 'ALLOW_DUPLICATES');\n\n-- AlterTable\nALTER TABLE \"ProjectConfig\" ADD COLUMN \"oauthAccountMergeStrategy\" \"OAuthAccountMergeStrategy\" NOT NULL DEFAULT 'LINK_METHOD';\n\n-- Update existing projects to use the new strategy\nUPDATE \"ProjectConfig\" SET \"oauthAccountMergeStrategy\" = 'ALLOW_DUPLICATES';\n"
  },
  {
    "name": "20250304200822_add_project_user_count",
    "sql": "-- AlterTable\nALTER TABLE \"Project\" ADD COLUMN     \"userCount\" INTEGER NOT NULL DEFAULT 0;\n\n-- Initialize userCount for existing projects\nUPDATE \"Project\" SET \"userCount\" = (\n    SELECT COUNT(*) FROM \"ProjectUser\" \n    WHERE \"ProjectUser\".\"mirroredProjectId\" = \"Project\".\"id\"\n);\n\n-- Create function to update userCount\n-- SPLIT_STATEMENT_SENTINEL\n-- SINGLE_STATEMENT_SENTINEL\nCREATE OR REPLACE FUNCTION update_project_user_count()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF TG_OP = 'INSERT' THEN\n        -- Increment userCount when a new ProjectUser is added\n        UPDATE \"Project\" SET \"userCount\" = \"userCount\" + 1\n        WHERE \"id\" = NEW.\"mirroredProjectId\";\n    ELSIF TG_OP = 'DELETE' THEN\n        -- Decrement userCount when a ProjectUser is deleted\n        UPDATE \"Project\" SET \"userCount\" = \"userCount\" - 1\n        WHERE \"id\" = OLD.\"mirroredProjectId\";\n    ELSIF TG_OP = 'UPDATE' AND OLD.\"mirroredProjectId\" <> NEW.\"mirroredProjectId\" THEN\n        -- If mirroredProjectId changed, decrement count for old project and increment for new project\n        UPDATE \"Project\" SET \"userCount\" = \"userCount\" - 1\n        WHERE \"id\" = OLD.\"mirroredProjectId\";\n        \n        UPDATE \"Project\" SET \"userCount\" = \"userCount\" + 1\n        WHERE \"id\" = NEW.\"mirroredProjectId\";\n    END IF;\n    RETURN NULL;\nEND;\n$$ LANGUAGE plpgsql;\n-- SPLIT_STATEMENT_SENTINEL\n\n-- Create triggers\nDROP TRIGGER IF EXISTS project_user_insert_trigger ON \"ProjectUser\";\nCREATE TRIGGER project_user_insert_trigger\nAFTER INSERT ON \"ProjectUser\"\nFOR EACH ROW\nEXECUTE FUNCTION update_project_user_count();\n\nDROP TRIGGER IF EXISTS project_user_update_trigger ON \"ProjectUser\";\nCREATE TRIGGER project_user_update_trigger\nAFTER UPDATE ON \"ProjectUser\"\nFOR EACH ROW\nEXECUTE FUNCTION update_project_user_count();\n\nDROP TRIGGER IF EXISTS project_user_delete_trigger ON \"ProjectUser\";\nCREATE TRIGGER project_user_delete_trigger\nAFTER DELETE ON \"ProjectUser\"\nFOR EACH ROW\nEXECUTE FUNCTION update_project_user_count();\n"
  },
  {
    "name": "20250310172256_add_id_and_impersonation_field",
    "sql": "/*\n  Warnings:\n\n  - The primary key for the `ProjectUserRefreshToken` table will be changed. If it partially fails, the table could be left without primary key constraint.\n  - The required column `id` was added to the `ProjectUserRefreshToken` table with a prisma-level default value. This is not possible if the table is not empty. Please add this column as optional, then populate it before making it required.\n\n*/\n-- AlterTable\nALTER TABLE \"ProjectUserRefreshToken\"\nADD COLUMN     \"id\" UUID,\nADD COLUMN     \"isImpersonation\" BOOLEAN NOT NULL DEFAULT false;\nUPDATE \"ProjectUserRefreshToken\" SET \"id\" = gen_random_uuid();\n\nALTER TABLE \"ProjectUserRefreshToken\" DROP CONSTRAINT \"ProjectUserRefreshToken_pkey\",\nALTER COLUMN \"id\" SET NOT NULL,\nADD CONSTRAINT \"ProjectUserRefreshToken_pkey\" PRIMARY KEY (\"tenancyId\", \"id\");\n"
  }
];
